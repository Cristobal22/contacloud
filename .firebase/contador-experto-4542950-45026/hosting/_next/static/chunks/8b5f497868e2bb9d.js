(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,90829,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(15288),i=e.i(19455),l=e.i(67489),n=e.i(10204),o=e.i(39126);e.i(11981);var s=e.i(80428),d=e.i(8406),c=e.i(45919),u=e.i(43104);function h(){let{selectedCompany:e}=t.default.useContext(o.SelectedCompanyContext)||{},h=e?.id,x=new Date().getFullYear(),m=new Date().getMonth()+1,{toast:p}=(0,d.useToast)(),[g,j]=t.default.useState(x.toString()),[b,C]=t.default.useState(m.toString()),[S,f]=t.default.useState(!1),{data:y,loading:v}=(0,s.useCollection)({path:`companies/${h}/payrolls`,companyId:h});return(0,a.jsxs)("div",{className:"grid gap-6",children:[(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{children:[(0,a.jsx)(r.CardTitle,{children:"Libro de Remuneraciones Electrónico"}),(0,a.jsx)(r.CardDescription,{children:"Genera el libro de remuneraciones en formato electrónico para la Dirección del Trabajo (DT)."})]}),(0,a.jsx)(r.CardContent,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-end max-w-lg",children:[(0,a.jsxs)("div",{className:"flex-1 grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{htmlFor:"month",children:"Mes"}),(0,a.jsxs)(l.Select,{value:b,onValueChange:C,disabled:!h||v||S,children:[(0,a.jsx)(l.SelectTrigger,{id:"month",children:(0,a.jsx)(l.SelectValue,{})}),(0,a.jsx)(l.SelectContent,{children:Array.from({length:12},(e,t)=>(0,a.jsx)(l.SelectItem,{value:(t+1).toString(),children:(0,c.format)(new Date(0,t),"MMMM",{locale:u.es})},t+1))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{htmlFor:"year",children:"Año"}),(0,a.jsxs)(l.Select,{value:g,onValueChange:j,disabled:!h||v||S,children:[(0,a.jsx)(l.SelectTrigger,{id:"year",children:(0,a.jsx)(l.SelectValue,{})}),(0,a.jsx)(l.SelectContent,{children:Array.from({length:5},(e,t)=>(0,a.jsx)(l.SelectItem,{value:(x-t).toString(),children:x-t},x-t))})]})]})]}),(0,a.jsx)(i.Button,{disabled:!h||v||S,onClick:()=>{f(!0);let e=parseInt(g),a=parseInt(b),t=y?.filter(t=>t.year===e&&t.month===a);if(!t||0===t.length){p({variant:"destructive",title:"Sin Datos",description:"No hay liquidaciones procesadas para generar el libro de este período."}),f(!1);return}let r=["Nombre,Periodo,Sueldo Base,Gratificacion,Haberes Imponibles,Haberes No Imponibles,Total Haberes,Descuento AFP,Descuento Salud,Total Descuentos,Sueldo Liquido"];t.forEach(e=>{let a=[e.employeeName,e.period,e.baseSalary.toFixed(0),e.gratification.toFixed(0),e.taxableEarnings.toFixed(0),e.nonTaxableEarnings.toFixed(0),e.totalEarnings.toFixed(0),e.afpDiscount.toFixed(0),e.healthDiscount.toFixed(0),e.totalDiscounts.toFixed(0),e.netSalary.toFixed(0)].join(",");r.push(a)});let i=new Blob(["\uFEFF"+r.join("\r\n")],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),n=URL.createObjectURL(i);l.setAttribute("href",n),l.setAttribute("download",`lre_${g}_${b}.csv`),document.body.appendChild(l),l.click(),document.body.removeChild(l),f(!1),p({title:"Libro Generado",description:"El Libro de Remuneraciones Electrónico ha sido descargado."})},children:v?"Cargando...":S?"Generando...":"Generar Libro"})]})})]}),(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{children:[(0,a.jsx)(r.CardTitle,{children:"Historial de Libros Generados"}),(0,a.jsx)(r.CardDescription,{children:h?"Aún no se ha generado ningún libro.":"Selecciona una empresa para ver el historial."})]}),(0,a.jsx)(r.CardContent,{children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Utiliza el generador para crear tu primer libro de remuneraciones."})})]})]})}e.s(["default",()=>h])}]);