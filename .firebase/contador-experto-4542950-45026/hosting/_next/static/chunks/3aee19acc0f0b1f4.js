(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(75157);let n=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("div",{ref:n,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));n.displayName="Card";let r=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("div",{ref:n,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",e),...t}));r.displayName="CardHeader";let o=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("div",{ref:n,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));o.displayName="CardTitle";let l=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("div",{ref:n,className:(0,s.cn)("text-sm text-muted-foreground",e),...t}));l.displayName="CardDescription";let i=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("div",{ref:n,className:(0,s.cn)("p-6 pt-0",e),...t}));i.displayName="CardContent";let c=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("div",{ref:n,className:(0,s.cn)("flex items-center p-6 pt-0",e),...t}));c.displayName="CardFooter",e.s(["Card",()=>n,"CardContent",()=>i,"CardDescription",()=>l,"CardFooter",()=>c,"CardHeader",()=>r,"CardTitle",()=>o])},84774,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(75157);let n=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:n,className:(0,s.cn)("w-full caption-bottom text-sm",e),...t})}));n.displayName="Table";let r=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("thead",{ref:n,className:(0,s.cn)("[&_tr]:border-b",e),...t}));r.displayName="TableHeader";let o=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("tbody",{ref:n,className:(0,s.cn)("[&_tr:last-child]:border-0",e),...t}));o.displayName="TableBody";let l=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("tfoot",{ref:n,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));l.displayName="TableFooter";let i=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("tr",{ref:n,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));i.displayName="TableRow";let c=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("th",{ref:n,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));c.displayName="TableHead";let d=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("td",{ref:n,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));d.displayName="TableCell",t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("caption",{ref:n,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption",e.s(["Table",()=>n,"TableBody",()=>o,"TableCell",()=>d,"TableFooter",()=>l,"TableHead",()=>c,"TableHeader",()=>r,"TableRow",()=>i])},10204,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(48425),n=t.forwardRef((e,t)=>(0,a.jsx)(s.Primitive.label,{...e,ref:t,onMouseDown:a=>{a.target.closest("button, input, select, textarea")||(e.onMouseDown?.(a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));n.displayName="Label";var r=e.i(25913),o=e.i(75157);let l=(0,r.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),i=t.forwardRef(({className:e,...t},s)=>(0,a.jsx)(n,{ref:s,className:(0,o.cn)(l(),e),...t}));i.displayName=n.displayName,e.s(["Label",()=>i],10204)},99682,e=>{"use strict";var a=e.i(71645);function t(e){let t=a.useRef({value:e,previous:e});return a.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}e.s(["usePrevious",()=>t])},27612,e=>{"use strict";let a=(0,e.i(75254).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>a],27612)},57428,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(20783),n=e.i(30030),r=e.i(81140),o=e.i(69340),l=e.i(99682),i=e.i(35804),c=e.i(96626),d=e.i(48425),u="Checkbox",[p,m]=(0,n.createContextScope)(u),[h,x]=p(u);function f(e){let{__scopeCheckbox:s,checked:n,children:r,defaultChecked:l,disabled:i,form:c,name:d,onCheckedChange:p,required:m,value:x="on",internal_do_not_use_render:f}=e,[v,g]=(0,o.useControllableState)({prop:n,defaultProp:l??!1,onChange:p,caller:u}),[b,j]=t.useState(null),[C,y]=t.useState(null),N=t.useRef(!1),P=!b||!!c||!!b.closest("form"),w={checked:v,disabled:i,setChecked:g,control:b,setControl:j,name:d,form:c,value:x,hasConsumerStoppedPropagationRef:N,required:m,defaultChecked:!A(l)&&l,isFormControl:P,bubbleInput:C,setBubbleInput:y};return(0,a.jsx)(h,{scope:s,...w,children:"function"==typeof f?f(w):r})}var v="CheckboxTrigger",g=t.forwardRef(({__scopeCheckbox:e,onKeyDown:n,onClick:o,...l},i)=>{let{control:c,value:u,disabled:p,checked:m,required:h,setControl:f,setChecked:g,hasConsumerStoppedPropagationRef:b,isFormControl:j,bubbleInput:C}=x(v,e),y=(0,s.useComposedRefs)(i,f),N=t.useRef(m);return t.useEffect(()=>{let e=c?.form;if(e){let a=()=>g(N.current);return e.addEventListener("reset",a),()=>e.removeEventListener("reset",a)}},[c,g]),(0,a.jsx)(d.Primitive.button,{type:"button",role:"checkbox","aria-checked":A(m)?"mixed":m,"aria-required":h,"data-state":P(m),"data-disabled":p?"":void 0,disabled:p,value:u,...l,ref:y,onKeyDown:(0,r.composeEventHandlers)(n,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,r.composeEventHandlers)(o,e=>{g(e=>!!A(e)||!e),C&&j&&(b.current=e.isPropagationStopped(),b.current||e.stopPropagation())})})});g.displayName=v;var b=t.forwardRef((e,t)=>{let{__scopeCheckbox:s,name:n,checked:r,defaultChecked:o,required:l,disabled:i,value:c,onCheckedChange:d,form:u,...p}=e;return(0,a.jsx)(f,{__scopeCheckbox:s,checked:r,defaultChecked:o,disabled:i,required:l,onCheckedChange:d,name:n,form:u,value:c,internal_do_not_use_render:({isFormControl:e})=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g,{...p,ref:t,__scopeCheckbox:s}),e&&(0,a.jsx)(N,{__scopeCheckbox:s})]})})});b.displayName=u;var j="CheckboxIndicator",C=t.forwardRef((e,t)=>{let{__scopeCheckbox:s,forceMount:n,...r}=e,o=x(j,s);return(0,a.jsx)(c.Presence,{present:n||A(o.checked)||!0===o.checked,children:(0,a.jsx)(d.Primitive.span,{"data-state":P(o.checked),"data-disabled":o.disabled?"":void 0,...r,ref:t,style:{pointerEvents:"none",...e.style}})})});C.displayName=j;var y="CheckboxBubbleInput",N=t.forwardRef(({__scopeCheckbox:e,...n},r)=>{let{control:o,hasConsumerStoppedPropagationRef:c,checked:u,defaultChecked:p,required:m,disabled:h,name:f,value:v,form:g,bubbleInput:b,setBubbleInput:j}=x(y,e),C=(0,s.useComposedRefs)(r,j),N=(0,l.usePrevious)(u),P=(0,i.useSize)(o);t.useEffect(()=>{if(!b)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,a=!c.current;if(N!==u&&e){let t=new Event("click",{bubbles:a});b.indeterminate=A(u),e.call(b,!A(u)&&u),b.dispatchEvent(t)}},[b,N,u,c]);let w=t.useRef(!A(u)&&u);return(0,a.jsx)(d.Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:p??w.current,required:m,disabled:h,name:f,value:v,form:g,...n,tabIndex:-1,ref:C,style:{...n.style,...P,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function A(e){return"indeterminate"===e}function P(e){return A(e)?"indeterminate":e?"checked":"unchecked"}N.displayName=y;var w=e.i(43531),R=e.i(75157);let I=t.forwardRef(({className:e,...t},s)=>(0,a.jsx)(b,{ref:s,className:(0,R.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:(0,a.jsx)(C,{className:(0,R.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(w.Check,{className:"h-4 w-4"})})}));I.displayName=b.displayName,e.s(["Checkbox",()=>I],57428)},37822,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(81140),n=e.i(20783),r=e.i(30030),o=e.i(26330),l=e.i(3536),i=e.i(65491),c=e.i(10772),d=e.i(53660),u=e.i(74606),p=e.i(96626),m=e.i(48425),h=e.i(91918),x=e.i(69340),f=e.i(86312),v=e.i(85369),g="Popover",[b,j]=(0,r.createContextScope)(g,[d.createPopperScope]),C=(0,d.createPopperScope)(),[y,N]=b(g),A=e=>{let{__scopePopover:s,children:n,open:r,defaultOpen:o,onOpenChange:l,modal:i=!1}=e,u=C(s),p=t.useRef(null),[m,h]=t.useState(!1),[f,v]=(0,x.useControllableState)({prop:r,defaultProp:o??!1,onChange:l,caller:g});return(0,a.jsx)(d.Root,{...u,children:(0,a.jsx)(y,{scope:s,contentId:(0,c.useId)(),triggerRef:p,open:f,onOpenChange:v,onOpenToggle:t.useCallback(()=>v(e=>!e),[v]),hasCustomAnchor:m,onCustomAnchorAdd:t.useCallback(()=>h(!0),[]),onCustomAnchorRemove:t.useCallback(()=>h(!1),[]),modal:i,children:n})})};A.displayName=g;var P="PopoverAnchor";t.forwardRef((e,s)=>{let{__scopePopover:n,...r}=e,o=N(P,n),l=C(n),{onCustomAnchorAdd:i,onCustomAnchorRemove:c}=o;return t.useEffect(()=>(i(),()=>c()),[i,c]),(0,a.jsx)(d.Anchor,{...l,...r,ref:s})}).displayName=P;var w="PopoverTrigger",R=t.forwardRef((e,t)=>{let{__scopePopover:r,...o}=e,l=N(w,r),i=C(r),c=(0,n.useComposedRefs)(t,l.triggerRef),u=(0,a.jsx)(m.Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":l.open,"aria-controls":l.contentId,"data-state":B(l.open),...o,ref:c,onClick:(0,s.composeEventHandlers)(e.onClick,l.onOpenToggle)});return l.hasCustomAnchor?u:(0,a.jsx)(d.Anchor,{asChild:!0,...i,children:u})});R.displayName=w;var I="PopoverPortal",[S,k]=b(I,{forceMount:void 0}),E=e=>{let{__scopePopover:t,forceMount:s,children:n,container:r}=e,o=N(I,t);return(0,a.jsx)(S,{scope:t,forceMount:s,children:(0,a.jsx)(p.Presence,{present:s||o.open,children:(0,a.jsx)(u.Portal,{asChild:!0,container:r,children:n})})})};E.displayName=I;var T="PopoverContent",D=t.forwardRef((e,t)=>{let s=k(T,e.__scopePopover),{forceMount:n=s.forceMount,...r}=e,o=N(T,e.__scopePopover);return(0,a.jsx)(p.Presence,{present:n||o.open,children:o.modal?(0,a.jsx)(V,{...r,ref:t}):(0,a.jsx)(H,{...r,ref:t})})});D.displayName=T;var F=(0,h.createSlot)("PopoverContent.RemoveScroll"),V=t.forwardRef((e,r)=>{let o=N(T,e.__scopePopover),l=t.useRef(null),i=(0,n.useComposedRefs)(r,l),c=t.useRef(!1);return t.useEffect(()=>{let e=l.current;if(e)return(0,f.hideOthers)(e)},[]),(0,a.jsx)(v.RemoveScroll,{as:F,allowPinchZoom:!0,children:(0,a.jsx)(O,{...e,ref:i,trapFocus:o.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,s.composeEventHandlers)(e.onCloseAutoFocus,e=>{e.preventDefault(),c.current||o.triggerRef.current?.focus()}),onPointerDownOutside:(0,s.composeEventHandlers)(e.onPointerDownOutside,e=>{let a=e.detail.originalEvent,t=0===a.button&&!0===a.ctrlKey;c.current=2===a.button||t},{checkForDefaultPrevented:!1}),onFocusOutside:(0,s.composeEventHandlers)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),H=t.forwardRef((e,s)=>{let n=N(T,e.__scopePopover),r=t.useRef(!1),o=t.useRef(!1);return(0,a.jsx)(O,{...e,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{e.onCloseAutoFocus?.(a),a.defaultPrevented||(r.current||n.triggerRef.current?.focus(),a.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:a=>{e.onInteractOutside?.(a),a.defaultPrevented||(r.current=!0,"pointerdown"===a.detail.originalEvent.type&&(o.current=!0));let t=a.target;n.triggerRef.current?.contains(t)&&a.preventDefault(),"focusin"===a.detail.originalEvent.type&&o.current&&a.preventDefault()}})}),O=t.forwardRef((e,t)=>{let{__scopePopover:s,trapFocus:n,onOpenAutoFocus:r,onCloseAutoFocus:c,disableOutsidePointerEvents:u,onEscapeKeyDown:p,onPointerDownOutside:m,onFocusOutside:h,onInteractOutside:x,...f}=e,v=N(T,s),g=C(s);return(0,l.useFocusGuards)(),(0,a.jsx)(i.FocusScope,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:r,onUnmountAutoFocus:c,children:(0,a.jsx)(o.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:u,onInteractOutside:x,onEscapeKeyDown:p,onPointerDownOutside:m,onFocusOutside:h,onDismiss:()=>v.onOpenChange(!1),children:(0,a.jsx)(d.Content,{"data-state":B(v.open),role:"dialog",id:v.contentId,...g,...f,ref:t,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),L="PopoverClose";function B(e){return e?"open":"closed"}t.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,o=N(L,n);return(0,a.jsx)(m.Primitive.button,{type:"button",...r,ref:t,onClick:(0,s.composeEventHandlers)(e.onClick,()=>o.onOpenChange(!1))})}).displayName=L,t.forwardRef((e,t)=>{let{__scopePopover:s,...n}=e,r=C(s);return(0,a.jsx)(d.Arrow,{...r,...n,ref:t})}).displayName="PopoverArrow";var _=e.i(75157);let M=t.forwardRef(({className:e,align:t="center",sideOffset:s=4,...n},r)=>(0,a.jsx)(E,{children:(0,a.jsx)(D,{ref:r,align:t,sideOffset:s,className:(0,_.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));M.displayName=D.displayName,e.s(["Popover",()=>A,"PopoverContent",()=>M,"PopoverTrigger",()=>R],37822)},44523,e=>{"use strict";let a=(0,e.i(75254).default)("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);e.s(["ChevronsUpDown",()=>a],44523)},888,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(43531),n=e.i(44523),r=e.i(75157),o=e.i(19455),l=e.i(17056),i=e.i(37822),c=e.i(10204);function d({label:e,value:d,onValueChange:u,accounts:p,loading:m}){let[h,x]=t.useState(!1),f=p.find(e=>e.code===d),v=(0,a.jsx)(i.PopoverContent,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,a.jsxs)(l.Command,{children:[(0,a.jsx)(l.CommandInput,{placeholder:"Buscar por código o nombre..."}),(0,a.jsxs)(l.CommandList,{children:[(0,a.jsx)(l.CommandEmpty,{children:"No se encontró ninguna cuenta."}),(0,a.jsx)(l.CommandGroup,{children:p.filter(e=>1===e.code.length).map(e=>(0,a.jsxs)(t.Fragment,{children:[(0,a.jsx)("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground",children:e.name}),p.filter(a=>a.code.startsWith(e.code)&&a.code!==e.code&&!(a.code.length<=5)).map(e=>(0,a.jsxs)(l.CommandItem,{value:`${e.code} ${e.name}`,onSelect:()=>{u(e.code),x(!1)},children:[(0,a.jsx)(s.Check,{className:(0,r.cn)("mr-2 h-4 w-4",d===e.code?"opacity-100":"opacity-0")}),e.code," - ",e.name]},e.id))]},e.code))})]})]})});return(0,a.jsxs)("div",{className:"space-y-2",children:[e&&(0,a.jsx)(c.Label,{children:e}),(0,a.jsxs)(i.Popover,{open:h,onOpenChange:x,children:[(0,a.jsx)(i.PopoverTrigger,{asChild:!0,children:(0,a.jsxs)(o.Button,{variant:"outline",role:"combobox","aria-expanded":h,className:"w-full justify-between font-normal",disabled:m,children:[m?"Cargando cuentas...":d?f?`${f.code} - ${f.name}`:d:"Seleccionar cuenta...",(0,a.jsx)(n.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),v]})]})}e.s(["AccountSearchInput",()=>d])},40274,e=>{"use strict";var a=e.i(43476),t=e.i(19455),s=e.i(15288),n=e.i(57428),r=e.i(55764),o=e.i(10204),l=e.i(71645);e.i(11981);var i=e.i(80428),c=e.i(61480),d=e.i(39126);e.i(36180);var u=e.i(17875),p=e.i(888),m=e.i(84774),h=e.i(27612);function x({accounts:e,loading:s,mappings:n,onChange:o}){let l=(e,a,t)=>{let s=[...n];s[e]={...s[e],[a]:t},o(s)};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(m.Table,{children:[(0,a.jsx)(m.TableHeader,{children:(0,a.jsxs)(m.TableRow,{children:[(0,a.jsx)(m.TableHead,{className:"w-1/5",children:"Código"}),(0,a.jsx)(m.TableHead,{className:"w-2/5",children:"Nombre del Impuesto"}),(0,a.jsx)(m.TableHead,{className:"w-2/5",children:"Cuenta Contable Asignada"}),(0,a.jsx)(m.TableHead,{className:"w-1/5 text-right"})]})}),(0,a.jsxs)(m.TableBody,{children:[n.map((i,c)=>(0,a.jsxs)(m.TableRow,{children:[(0,a.jsx)(m.TableCell,{children:(0,a.jsx)(r.Input,{value:i.taxCode,onChange:e=>l(c,"taxCode",e.target.value),placeholder:"Ej: 271"})}),(0,a.jsx)(m.TableCell,{children:(0,a.jsx)(r.Input,{value:i.name,onChange:e=>l(c,"name",e.target.value),placeholder:"Ej: Mi Impuesto Específico"})}),(0,a.jsx)(m.TableCell,{children:(0,a.jsx)(p.AccountSearchInput,{label:"",value:i.accountCode,accounts:e,loading:s,onValueChange:e=>l(c,"accountCode",e),placeholder:"Buscar o seleccionar cuenta..."})}),(0,a.jsx)(m.TableCell,{className:"text-right",children:(0,a.jsx)(t.Button,{variant:"ghost",size:"icon",onClick:()=>{o(n.filter((e,a)=>a!==c))},children:(0,a.jsx)(h.Trash2,{className:"h-4 w-4"})})})]},c)),0===n.length&&(0,a.jsx)(m.TableRow,{children:(0,a.jsx)(m.TableCell,{colSpan:4,className:"text-center text-muted-foreground h-24",children:"No hay impuestos personalizados. Añade uno para empezar."})})]})]}),(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)(t.Button,{variant:"outline",size:"sm",onClick:()=>{o([...n,{taxCode:"",name:"",accountCode:""}])},children:"Añadir Impuesto"})})]})}var f=e.i(57094),v=e.i(50350),g=e.i(8406);e.i(61978);var b=e.i(94397),j=e.i(18566),C=e.i(76639);function y({company:e}){let[s,n]=l.default.useState(!1),[i,d]=l.default.useState(""),[u,p]=l.default.useState(!1),{toast:m}=(0,g.useToast)(),h=(0,c.useFunctions)(),x=(0,j.useRouter)(),f=async()=>{if(i!==e.name)return void m({variant:"destructive",title:"Error",description:"El nombre de la empresa no coincide."});p(!0);try{let a=(0,b.httpsCallable)(h,"deleteCompany");await a({companyId:e.id}),m({title:"Empresa eliminada",description:`La empresa ${e.name} y todos sus datos han sido eliminados.`}),n(!1),x.push("/dashboard")}catch(e){console.error("Error deleting company:",e),m({variant:"destructive",title:"Error al eliminar",description:e.message||"Ocurrió un error inesperado. Por favor, revisa los logs de la función."})}finally{p(!1),d("")}};return(0,a.jsxs)(C.Dialog,{open:s,onOpenChange:n,children:[(0,a.jsx)(C.DialogTrigger,{asChild:!0,children:(0,a.jsx)(t.Button,{variant:"destructive",children:"Eliminar Empresa"})}),(0,a.jsxs)(C.DialogContent,{children:[(0,a.jsxs)(C.DialogHeader,{children:[(0,a.jsx)(C.DialogTitle,{children:"¿Estás absolutamente seguro?"}),(0,a.jsxs)(C.DialogDescription,{children:["Esta acción es irreversible. Se eliminarán permanentemente la empresa",(0,a.jsx)("span",{className:"font-bold text-foreground",children:e.name}),"y todos sus datos asociados, incluyendo cuentas, compras, ventas, empleados y comprobantes."]})]}),(0,a.jsxs)("div",{className:"space-y-2 py-4",children:[(0,a.jsxs)(o.Label,{htmlFor:"company-name-confirmation",children:["Por favor, escribe ",(0,a.jsx)("span",{className:"font-bold text-foreground",children:e.name})," para confirmar."]}),(0,a.jsx)(r.Input,{id:"company-name-confirmation",value:i,onChange:e=>d(e.target.value),placeholder:"Nombre de la empresa",autoComplete:"off"})]}),(0,a.jsxs)(C.DialogFooter,{children:[(0,a.jsx)(t.Button,{variant:"outline",onClick:()=>n(!1),disabled:u,children:"Cancelar"}),(0,a.jsx)(t.Button,{variant:"destructive",onClick:f,disabled:u||i!==e.name,children:u?"Eliminando...":"Entiendo las consecuencias, eliminar esta empresa"})]})]})]})}let N={profitAccount:"40105",lossAccount:"40192",salesInvoicesReceivableAccount:"1010401",salesNotesReceivableAccount:"1010401",salesVatAccount:"2010920",purchasesInvoicesPayableAccount:"2010201",purchasesNotesPayableAccount:"2010201",purchasesVatAccount:"1010802",vatRemanentAccount:"1010803",feesExpenseAccount:"4010820",feesPayableAccount:"2010220",feesWithholdingAccount:"2010930",incomeFeesReceivableAccount:"1010415",incomeFeesWithholdingAccount:"2010940",remunerationExpenseAccount:"4010810",salariesPayableAccount:"2010215",afpPayableAccount:"2010225",healthPayableAccount:"2010225",unemploymentInsurancePayableAccount:"2010225",employerAfpContributionPayableAccount:"2010226"};function A(){let{selectedCompany:e,setSelectedCompany:m}=l.default.useContext(d.SelectedCompanyContext)||{},[h,b]=l.default.useState(null),j=(0,c.useFirestore)(),{toast:C}=(0,g.useToast)();l.default.useEffect(()=>{e?b(e):b(null)},[e]);let{data:A,loading:P}=(0,i.useCollection)({path:e?`companies/${e.id}/accounts`:void 0,companyId:e?.id}),w=(e,a)=>{h&&b({...h,[e]:a})},R=(e,a)=>{h&&b({...h,["sales"===e?"salesOtherTaxesAccounts":"purchasesOtherTaxesAccounts"]:a})},I=(e,a)=>{h&&b({...h,[e]:a})},S=e=>{if(e&&e.id&&j){let{id:a,...t}=e,s=(0,u.doc)(j,"companies",a);(0,u.updateDoc)(s,t).then(()=>{C({title:"Configuración guardada",description:"Los cambios han sido guardados exitosamente."}),m&&m(e)}).catch(e=>{f.errorEmitter.emit("permission-error",new v.FirestorePermissionError({path:s.path,operation:"update",requestResourceData:t}))})}};return h?(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(s.CardTitle,{children:"Configuración de la Empresa"}),(0,a.jsxs)(s.CardDescription,{children:["Modificación de datos para ",h.name]})]}),(0,a.jsx)(t.Button,{variant:"outline",onClick:()=>{if(!A||0===A.length)return void C({variant:"destructive",title:"Error",description:"No hay un plan de cuentas cargado para esta empresa."});let e=new Map(A.map(e=>[e.code,e])),a={...h},t=[];for(let s in N){let n=N[s];e.has(n)?a[s]=n:t.push(`${s} (c\xf3digo ${n})`)}t.length>0?C({variant:"destructive",title:"Faltan Cuentas Predeterminadas",description:`No se pudieron asignar todas las cuentas. Faltan las siguientes: ${t.join(", ")}.`,duration:1e4}):(b(a),S(a),C({title:"Cuentas Asignadas y Guardadas",description:"Se han asignado y guardado las cuentas predeterminadas."}))},disabled:P,children:"Asignar Cuentas Predeterminadas"})]})}),(0,a.jsxs)(s.CardContent,{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.Label,{htmlFor:"companyName",children:"Nombre/Razón Social"}),(0,a.jsx)(r.Input,{id:"companyName",value:h.name||"",onChange:e=>w("name",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.Label,{htmlFor:"rut",children:"RUT"}),(0,a.jsx)(r.Input,{id:"rut",value:h.rut||"",onChange:e=>w("rut",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.Label,{htmlFor:"address",children:"Dirección"}),(0,a.jsx)(r.Input,{id:"address",value:h.address||"",onChange:e=>w("address",e.target.value)})]})]}),(0,a.jsxs)("div",{className:"space-y-2 mt-4",children:[(0,a.jsx)(o.Label,{htmlFor:"giro",children:"Giro o Actividad Comercial"}),(0,a.jsx)(r.Input,{id:"giro",value:h.giro||"",onChange:e=>w("giro",e.target.value)}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Consulte los códigos de actividad en el ",(0,a.jsx)("a",{href:"https://www.sii.cl/ayudas/ayudas_por_servicios/1956-codigos-1959.html",target:"_blank",rel:"noopener noreferrer",className:"text-primary underline",children:"sitio del SII"}),"."]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 pt-4",children:[(0,a.jsx)(n.Checkbox,{id:"isDistributor",checked:!!h.isDistributor,onCheckedChange:e=>I("isDistributor",!!e)}),(0,a.jsx)(o.Label,{htmlFor:"isDistributor",children:"Es Distribuidora (recupera imp. Art. 42)"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Período de Digitación"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.Label,{htmlFor:"startYear",children:"Año de Inicio"}),(0,a.jsx)(r.Input,{id:"startYear",type:"number",value:h.startYear||"",onChange:e=>w("startYear",parseInt(e.target.value))})]}),(0,a.jsx)("div",{className:"space-y-2"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.Label,{htmlFor:"periodStartDate",children:"Fecha inicial"}),(0,a.jsx)(r.Input,{id:"periodStartDate",type:"date",value:h.periodStartDate||"",onChange:e=>w("periodStartDate",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.Label,{htmlFor:"periodEndDate",children:"Fecha final"}),(0,a.jsx)(r.Input,{id:"periodEndDate",type:"date",value:h.periodEndDate||"",onChange:e=>w("periodEndDate",e.target.value)})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Cuentas Contables Principales"}),(0,a.jsx)(p.AccountSearchInput,{label:"Cuenta de Ganancia",value:h.profitAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("profitAccount",e)}),(0,a.jsx)(p.AccountSearchInput,{label:"Cuenta de Pérdida",value:h.lossAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("lossAccount",e)})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Impuestos (IVA)"}),(0,a.jsx)(p.AccountSearchInput,{label:"IVA Débito Fiscal (Ventas)",value:h.salesVatAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("salesVatAccount",e)}),(0,a.jsx)(p.AccountSearchInput,{label:"IVA Crédito Fiscal (Compras)",value:h.purchasesVatAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("purchasesVatAccount",e)}),(0,a.jsx)(p.AccountSearchInput,{label:"IVA Remanente Crédito (Arrastre)",value:h.vatRemanentAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("vatRemanentAccount",e)}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 pt-2",children:[(0,a.jsx)(n.Checkbox,{id:"proportionalVat",checked:!!h.proportionalVat,onCheckedChange:e=>I("proportionalVat",!!e)}),(0,a.jsx)(o.Label,{htmlFor:"proportionalVat",children:"Utiliza IVA Proporcional"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Cuentas de Ventas"}),(0,a.jsx)(p.AccountSearchInput,{label:"Facturas por Cobrar",value:h.salesInvoicesReceivableAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("salesInvoicesReceivableAccount",e)}),(0,a.jsx)(p.AccountSearchInput,{label:"Boletas por Cobrar",value:h.salesNotesReceivableAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("salesNotesReceivableAccount",e)})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Otros Impuestos y Retenciones (Ventas)"}),(0,a.jsx)(x,{accounts:A||[],loading:P,mappings:h.salesOtherTaxesAccounts||[],onChange:e=>R("sales",e)})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Cuentas de Compras"}),(0,a.jsx)(p.AccountSearchInput,{label:"Facturas por Pagar",value:h.purchasesInvoicesPayableAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("purchasesInvoicesPayableAccount",e)}),(0,a.jsx)(p.AccountSearchInput,{label:"Boletas por Pagar",value:h.purchasesNotesPayableAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("purchasesNotesPayableAccount",e)})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Otros Impuestos y Retenciones (Compras)"}),(0,a.jsx)(x,{accounts:A||[],loading:P,mappings:h.purchasesOtherTaxesAccounts||[],onChange:e=>R("purchases",e)})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Honorarios"}),(0,a.jsx)(p.AccountSearchInput,{label:"Cuenta de Gasto (Honorarios)",value:h.feesExpenseAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("feesExpenseAccount",e)}),(0,a.jsx)(p.AccountSearchInput,{label:"Honorarios por Pagar",value:h.feesPayableAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("feesPayableAccount",e)}),(0,a.jsx)(p.AccountSearchInput,{label:"Retenciones 2da Categoría",value:h.feesWithholdingAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("feesWithholdingAccount",e)})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Ingresos Honorarios"}),(0,a.jsx)(p.AccountSearchInput,{label:"Clientes Honorarios",value:h.incomeFeesReceivableAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("incomeFeesReceivableAccount",e)}),(0,a.jsx)(p.AccountSearchInput,{label:"Retenciones por Pagar",value:h.incomeFeesWithholdingAccount||"",accounts:A||[],loading:P,"onValue-change":e=>w("incomeFeesWithholdingAccount",e)})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Remuneraciones"}),(0,a.jsx)(p.AccountSearchInput,{label:"Cuenta de Gasto (Sueldos)",value:h.remunerationExpenseAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("remunerationExpenseAccount",e)}),(0,a.jsx)(p.AccountSearchInput,{label:"Sueldos por Pagar",value:h.salariesPayableAccount||"",accounts:A||[],loading:P,"onValue-change":e=>w("salariesPayableAccount",e)}),(0,a.jsx)(p.AccountSearchInput,{label:"Leyes Sociales por Pagar (AFP)",value:h.afpPayableAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("afpPayableAccount",e)}),(0,a.jsx)(p.AccountSearchInput,{label:"Aporte Patronal AFP por Pagar (1%)",value:h.employerAfpContributionPayableAccount||"",accounts:A||[],loading:P,"onValue-change":e=>w("employerAfpContributionPayableAccount",e)}),(0,a.jsx)(p.AccountSearchInput,{label:"Leyes Sociales por Pagar (Salud)",value:h.healthPayableAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("healthPayableAccount",e)}),(0,a.jsx)(p.AccountSearchInput,{label:"Seguro de Cesantía por Pagar",value:h.unemploymentInsurancePayableAccount||"",accounts:A||[],loading:P,onValueChange:e=>w("unemploymentInsurancePayableAccount",e)})]}),(0,a.jsx)("div",{className:"flex justify-end pt-4",children:(0,a.jsx)(t.Button,{onClick:()=>S(h),children:"Guardar Cambios"})}),(0,a.jsxs)("div",{className:"space-y-4 pt-8",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-destructive",children:"Zona de Peligro"}),(0,a.jsx)("div",{className:"rounded-lg border border-destructive bg-destructive/5 p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold",children:"Eliminar esta empresa"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Una vez eliminada, la empresa y todos sus datos se perderán para siempre."})]}),(0,a.jsx)(y,{company:h})]})})]})]})]}):(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsx)(s.CardTitle,{children:"Configuración de la Empresa"}),(0,a.jsx)(s.CardDescription,{children:"Por favor, selecciona una empresa desde el menú superior para ver su configuración."})]}),(0,a.jsx)(s.CardContent,{children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"No hay ninguna empresa seleccionada."})})]})}e.s(["default",()=>A],40274)}]);