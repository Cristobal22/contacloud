(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(75157);let o=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{ref:o,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...a}));o.displayName="Card";let s=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{ref:o,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",e),...a}));s.displayName="CardHeader";let n=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{ref:o,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",e),...a}));n.displayName="CardTitle";let i=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{ref:o,className:(0,r.cn)("text-sm text-muted-foreground",e),...a}));i.displayName="CardDescription";let l=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{ref:o,className:(0,r.cn)("p-6 pt-0",e),...a}));l.displayName="CardContent";let d=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{ref:o,className:(0,r.cn)("flex items-center p-6 pt-0",e),...a}));d.displayName="CardFooter",e.s(["Card",()=>o,"CardContent",()=>l,"CardDescription",()=>i,"CardFooter",()=>d,"CardHeader",()=>s,"CardTitle",()=>n])},84774,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(75157);let o=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:o,className:(0,r.cn)("w-full caption-bottom text-sm",e),...a})}));o.displayName="Table";let s=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("thead",{ref:o,className:(0,r.cn)("[&_tr]:border-b",e),...a}));s.displayName="TableHeader";let n=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("tbody",{ref:o,className:(0,r.cn)("[&_tr:last-child]:border-0",e),...a}));n.displayName="TableBody";let i=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("tfoot",{ref:o,className:(0,r.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a}));i.displayName="TableFooter";let l=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("tr",{ref:o,className:(0,r.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a}));l.displayName="TableRow";let d=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("th",{ref:o,className:(0,r.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...a}));d.displayName="TableHead";let c=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("td",{ref:o,className:(0,r.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...a}));c.displayName="TableCell",a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("caption",{ref:o,className:(0,r.cn)("mt-4 text-sm text-muted-foreground",e),...a})).displayName="TableCaption",e.s(["Table",()=>o,"TableBody",()=>n,"TableCell",()=>c,"TableFooter",()=>i,"TableHead",()=>d,"TableHeader",()=>s,"TableRow",()=>l])},74323,e=>{"use strict";let t=(0,e.i(75254).default)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);e.s(["PlusCircle",()=>t],74323)},87486,e=>{"use strict";var t=e.i(43476),a=e.i(25913),r=e.i(75157);let o=(0,a.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function s({className:e,variant:a,...s}){return(0,t.jsx)("div",{className:(0,r.cn)(o({variant:a}),e),...s})}e.s(["Badge",()=>s])},27612,e=>{"use strict";let t=(0,e.i(75254).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>t],27612)},37822,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(81140),o=e.i(20783),s=e.i(30030),n=e.i(26330),i=e.i(3536),l=e.i(65491),d=e.i(10772),c=e.i(53660),u=e.i(74606),p=e.i(96626),h=e.i(48425),m=e.i(91918),f=e.i(69340),x=e.i(86312),b=e.i(85369),v="Popover",[g,j]=(0,s.createContextScope)(v,[c.createPopperScope]),C=(0,c.createPopperScope)(),[y,N]=g(v),w=e=>{let{__scopePopover:r,children:o,open:s,defaultOpen:n,onOpenChange:i,modal:l=!1}=e,u=C(r),p=a.useRef(null),[h,m]=a.useState(!1),[x,b]=(0,f.useControllableState)({prop:s,defaultProp:n??!1,onChange:i,caller:v});return(0,t.jsx)(c.Root,{...u,children:(0,t.jsx)(y,{scope:r,contentId:(0,d.useId)(),triggerRef:p,open:x,onOpenChange:b,onOpenToggle:a.useCallback(()=>b(e=>!e),[b]),hasCustomAnchor:h,onCustomAnchorAdd:a.useCallback(()=>m(!0),[]),onCustomAnchorRemove:a.useCallback(()=>m(!1),[]),modal:l,children:o})})};w.displayName=v;var T="PopoverAnchor";a.forwardRef((e,r)=>{let{__scopePopover:o,...s}=e,n=N(T,o),i=C(o),{onCustomAnchorAdd:l,onCustomAnchorRemove:d}=n;return a.useEffect(()=>(l(),()=>d()),[l,d]),(0,t.jsx)(c.Anchor,{...i,...s,ref:r})}).displayName=T;var S="PopoverTrigger",P=a.forwardRef((e,a)=>{let{__scopePopover:s,...n}=e,i=N(S,s),l=C(s),d=(0,o.useComposedRefs)(a,i.triggerRef),u=(0,t.jsx)(h.Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":B(i.open),...n,ref:d,onClick:(0,r.composeEventHandlers)(e.onClick,i.onOpenToggle)});return i.hasCustomAnchor?u:(0,t.jsx)(c.Anchor,{asChild:!0,...l,children:u})});P.displayName=S;var R="PopoverPortal",[D,k]=g(R,{forceMount:void 0}),E=e=>{let{__scopePopover:a,forceMount:r,children:o,container:s}=e,n=N(R,a);return(0,t.jsx)(D,{scope:a,forceMount:r,children:(0,t.jsx)(p.Presence,{present:r||n.open,children:(0,t.jsx)(u.Portal,{asChild:!0,container:s,children:o})})})};E.displayName=R;var I="PopoverContent",F=a.forwardRef((e,a)=>{let r=k(I,e.__scopePopover),{forceMount:o=r.forceMount,...s}=e,n=N(I,e.__scopePopover);return(0,t.jsx)(p.Presence,{present:o||n.open,children:n.modal?(0,t.jsx)(A,{...s,ref:a}):(0,t.jsx)(H,{...s,ref:a})})});F.displayName=I;var O=(0,m.createSlot)("PopoverContent.RemoveScroll"),A=a.forwardRef((e,s)=>{let n=N(I,e.__scopePopover),i=a.useRef(null),l=(0,o.useComposedRefs)(s,i),d=a.useRef(!1);return a.useEffect(()=>{let e=i.current;if(e)return(0,x.hideOthers)(e)},[]),(0,t.jsx)(b.RemoveScroll,{as:O,allowPinchZoom:!0,children:(0,t.jsx)($,{...e,ref:l,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,r.composeEventHandlers)(e.onCloseAutoFocus,e=>{e.preventDefault(),d.current||n.triggerRef.current?.focus()}),onPointerDownOutside:(0,r.composeEventHandlers)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,a=0===t.button&&!0===t.ctrlKey;d.current=2===t.button||a},{checkForDefaultPrevented:!1}),onFocusOutside:(0,r.composeEventHandlers)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),H=a.forwardRef((e,r)=>{let o=N(I,e.__scopePopover),s=a.useRef(!1),n=a.useRef(!1);return(0,t.jsx)($,{...e,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(s.current||o.triggerRef.current?.focus(),t.preventDefault()),s.current=!1,n.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(s.current=!0,"pointerdown"===t.detail.originalEvent.type&&(n.current=!0));let a=t.target;o.triggerRef.current?.contains(a)&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&n.current&&t.preventDefault()}})}),$=a.forwardRef((e,a)=>{let{__scopePopover:r,trapFocus:o,onOpenAutoFocus:s,onCloseAutoFocus:d,disableOutsidePointerEvents:u,onEscapeKeyDown:p,onPointerDownOutside:h,onFocusOutside:m,onInteractOutside:f,...x}=e,b=N(I,r),v=C(r);return(0,i.useFocusGuards)(),(0,t.jsx)(l.FocusScope,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:s,onUnmountAutoFocus:d,children:(0,t.jsx)(n.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:u,onInteractOutside:f,onEscapeKeyDown:p,onPointerDownOutside:h,onFocusOutside:m,onDismiss:()=>b.onOpenChange(!1),children:(0,t.jsx)(c.Content,{"data-state":B(b.open),role:"dialog",id:b.contentId,...v,...x,ref:a,style:{...x.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),L="PopoverClose";function B(e){return e?"open":"closed"}a.forwardRef((e,a)=>{let{__scopePopover:o,...s}=e,n=N(L,o);return(0,t.jsx)(h.Primitive.button,{type:"button",...s,ref:a,onClick:(0,r.composeEventHandlers)(e.onClick,()=>n.onOpenChange(!1))})}).displayName=L,a.forwardRef((e,a)=>{let{__scopePopover:r,...o}=e,s=C(r);return(0,t.jsx)(c.Arrow,{...s,...o,ref:a})}).displayName="PopoverArrow";var M=e.i(75157);let z=a.forwardRef(({className:e,align:a="center",sideOffset:r=4,...o},s)=>(0,t.jsx)(E,{children:(0,t.jsx)(F,{ref:s,align:a,sideOffset:r,className:(0,M.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...o})}));z.displayName=F.displayName,e.s(["Popover",()=>w,"PopoverContent",()=>z,"PopoverTrigger",()=>P],37822)},44523,e=>{"use strict";let t=(0,e.i(75254).default)("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);e.s(["ChevronsUpDown",()=>t],44523)},63209,e=>{"use strict";let t=(0,e.i(75254).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},71689,e=>{"use strict";let t=(0,e.i(75254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},14378,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(15288),o=e.i(19455),s=e.i(84774),n=e.i(74323),i=e.i(27612),l=e.i(71689),d=e.i(44523),c=e.i(43531),u=e.i(63209),p=e.i(87486),h=e.i(55764),m=e.i(10204),f=e.i(67489),x=e.i(17056),b=e.i(37822);e.i(11981);var v=e.i(80428),g=e.i(41899),j=e.i(61480),C=e.i(39126);e.i(36180);var y=e.i(17875),N=e.i(18566),w=e.i(22016),T=e.i(57094),S=e.i(50350),P=e.i(45919),R=e.i(86135),D=e.i(43104),k=e.i(8406),E=e.i(75157);let I=({items:e})=>0===e.length?null:(0,t.jsx)("div",{className:"text-sm text-muted-foreground space-y-2 mr-auto",children:e.map((e,a)=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(u.AlertCircle,{className:"h-4 w-4 text-amber-500"}),(0,t.jsx)("span",{children:e})]},a))});function F(){let e=(0,N.useParams)().id,u="new"===e,{selectedCompany:F}=a.default.useContext(C.SelectedCompanyContext)||{},O=F?.id,A=(0,j.useFirestore)(),H=(0,N.useRouter)(),{toast:$}=(0,k.useToast)(),L=!u&&A&&O?(0,y.doc)(A,`companies/${O}/vouchers`,e):null,{data:B,loading:M}=(0,g.useDoc)(L),[z,_]=a.default.useState(null),[U,V]=a.default.useState([]),[q,G]=a.default.useState(null),[K,W]=a.default.useState({}),[Z,J]=a.default.useState([]),{data:Q,loading:X}=(0,v.useCollection)({path:O?`companies/${O}/accounts`:void 0,companyId:O});a.default.useEffect(()=>{u?(_({date:new Date().toISOString().substring(0,10),type:"Traspaso",description:"",status:"Borrador",total:0,entries:[],companyId:O}),V([{id:`new-entry-${Date.now()}-${Math.random()}`,account:"",description:"",debit:0,credit:0}])):B&&(_(B),V(B.entries))},[u,B,O]),a.default.useEffect(()=>{z?.date&&F&&ee(z.date)},[z?.date,F]);let Y=(e,t,a)=>{V(U.map(r=>{if(r.id===e){let e={...r,[t]:a};return"debit"===t&&Number(a)>0&&(e.credit=0),"credit"===t&&Number(a)>0&&(e.debit=0),e}return r}))},ee=e=>{if(!F?.periodStartDate||!F?.periodEndDate)return G("La empresa no tiene un período de trabajo configurado."),!1;let t=(0,R.parseISO)(e),a=(0,R.parseISO)(F.periodStartDate),r=(0,R.parseISO)(F.periodEndDate);return t<a||t>r?(G("La fecha está fuera del período de trabajo activo."),!1):F.lastClosedDate&&t<=(0,R.parseISO)(F.lastClosedDate)?(G("La fecha pertenece a un período que ya ha sido cerrado."),!1):(G(null),!0)},et=(e,t)=>{z&&("date"===e&&ee(t),_({...z,[e]:t}))},ea=U.reduce((e,t)=>e+Number(t.debit||0),0),er=U.reduce((e,t)=>e+Number(t.credit||0),0),eo=Math.round(ea)===Math.round(er)&&ea>0,es=eo&&!q&&U.length>0&&!!z?.description&&U.every(e=>e.account);a.default.useEffect(()=>{let e=[];z?.description||e.push("Falta la descripción general del comprobante."),0===U.length&&e.push("El comprobante debe tener al menos un asiento."),U.every(e=>e.account)||e.push("Hay uno o más asientos sin una cuenta contable asignada."),q&&e.push(q),0===ea&&U.length>0?e.push("Los totales no pueden ser cero."):Math.round(ea)!==Math.round(er)&&e.push("Los totales del Debe y el Haber no cuadran."),J(e)},[z,U,q,ea,er]);let en=async()=>{if(!A||!O||!z||!es)return;let t=z.status;"Contabilizado"===z.status&&(t="Borrador",$({title:"Comprobante revertido a Borrador",description:"Se han guardado cambios en un comprobante contabilizado. Su estado ha sido revertido a 'Borrador' y debe ser contabilizado nuevamente."}));let a=`companies/${O}/vouchers`,r=(0,y.collection)(A,a),o={date:z.date||new Date().toISOString().substring(0,10),type:z.type||"Traspaso",description:z.description||"",status:t,total:ea,entries:U.map(e=>({account:e.account||"",description:e.description||"",debit:e.debit||0,credit:e.credit||0,id:e.id&&!e.id.startsWith("new-")?e.id:`entry-${Date.now()}-${Math.random()}`})),companyId:O};try{if(u)await (0,y.addDoc)(r,o),$({title:"Éxito",description:"El comprobante ha sido creado."});else{let t=(0,y.doc)(A,a,e);await (0,y.setDoc)(t,o,{merge:!0}),$({title:"Éxito",description:"El comprobante ha sido actualizado."})}H.push("/dashboard/vouchers")}catch(r){$({title:"Error al guardar",description:"No se pudo guardar el comprobante. Por favor, intenta de nuevo.",variant:"destructive"});let t=u?a:`companies/${O}/vouchers/${e}`;T.errorEmitter.emit("permission-error",new S.FirestorePermissionError({path:t,operation:u?"create":"update",requestResourceData:o}))}};if(M&&!u)return(0,t.jsx)("p",{children:"Cargando comprobante..."});if(!u&&!z&&!M)return(0,t.jsx)("p",{children:"No se encontró el comprobante."});if(!z)return null;let ei=F?.periodStartDate&&F?.periodEndDate,el=F?.lastClosedDate?`\xdaltimo cierre: ${(0,P.format)((0,R.parseISO)(F.lastClosedDate),"P",{locale:D.es})}.`:"Aún no hay períodos cerrados.",ed=e=>{W(t=>({...t,[e]:!t[e]}))};return(0,t.jsx)("div",{className:"grid gap-6",children:(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(o.Button,{variant:"outline",size:"icon",asChild:!0,children:(0,t.jsx)(w.default,{href:"/dashboard/vouchers",children:(0,t.jsx)(l.ArrowLeft,{className:"h-4 w-4"})})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(r.CardTitle,{children:u?"Nuevo Comprobante":`Editar Comprobante #${e.substring(0,6)}`}),(0,t.jsx)(r.CardDescription,{children:ei?`Per\xedodo activo: ${(0,P.format)((0,R.parseISO)(F.periodStartDate),"P",{locale:D.es})} - ${(0,P.format)((0,R.parseISO)(F.periodEndDate),"P",{locale:D.es})}. ${el}`:"Define el período de trabajo en la configuración de la empresa."})]}),(0,t.jsx)(p.Badge,{variant:"Contabilizado"===z.status?"outline":"secondary",children:z.status})]})})]})}),(0,t.jsxs)(r.CardContent,{className:"space-y-8",children:[(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m.Label,{htmlFor:"voucher-date",children:"Fecha"}),(0,t.jsx)(h.Input,{id:"voucher-date",type:"date",value:z.date||"",onChange:e=>et("date",e.target.value),disabled:!ei}),q&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:q})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m.Label,{htmlFor:"voucher-type",children:"Tipo"}),(0,t.jsxs)(f.Select,{value:z.type,onValueChange:e=>et("type",e),disabled:!ei,children:[(0,t.jsx)(f.SelectTrigger,{id:"voucher-type",children:(0,t.jsx)(f.SelectValue,{placeholder:"Selecciona un tipo"})}),(0,t.jsxs)(f.SelectContent,{children:[(0,t.jsx)(f.SelectItem,{value:"Ingreso",children:"Ingreso"}),(0,t.jsx)(f.SelectItem,{value:"Egreso",children:"Egreso"}),(0,t.jsx)(f.SelectItem,{value:"Traspaso",children:"Traspaso"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m.Label,{htmlFor:"voucher-description",children:"Descripción"}),(0,t.jsx)(h.Input,{id:"voucher-description",value:z.description||"",onChange:e=>et("description",e.target.value),placeholder:"Ej: Pago de factura #101",disabled:!ei})]})]}),(0,t.jsxs)(s.Table,{children:[(0,t.jsx)(s.TableHeader,{children:(0,t.jsxs)(s.TableRow,{children:[(0,t.jsx)(s.TableHead,{className:"w-[300px]",children:"Cuenta Contable"}),(0,t.jsx)(s.TableHead,{children:"Descripción"}),(0,t.jsx)(s.TableHead,{className:"w-[180px] text-right",children:"Debe"}),(0,t.jsx)(s.TableHead,{className:"w-[180px] text-right",children:"Haber"}),(0,t.jsx)(s.TableHead,{className:"w-[50px]"})]})}),(0,t.jsxs)(s.TableBody,{children:[U.map(e=>(0,t.jsxs)(s.TableRow,{children:[(0,t.jsx)(s.TableCell,{children:(0,t.jsxs)(b.Popover,{open:K[e.id]||!1,onOpenChange:()=>ed(e.id),children:[(0,t.jsx)(b.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(o.Button,{variant:"outline",role:"combobox","aria-expanded":K[e.id]||!1,className:"w-full justify-between font-normal",disabled:X||!ei,children:[X?"Cargando...":e.account?Q?.find(t=>t.code===e.account)?.name:"Seleccionar cuenta...",(0,t.jsx)(d.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,t.jsx)(b.PopoverContent,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,t.jsxs)(x.Command,{children:[(0,t.jsx)(x.CommandInput,{placeholder:"Buscar cuenta..."}),(0,t.jsxs)(x.CommandList,{children:[(0,t.jsx)(x.CommandEmpty,{children:"No se encontró la cuenta."}),(0,t.jsx)(x.CommandGroup,{children:Q?.map(a=>(0,t.jsxs)(x.CommandItem,{value:`${a.code} ${a.name}`,onSelect:()=>{Y(e.id,"account",a.code),ed(e.id)},children:[(0,t.jsx)(c.Check,{className:(0,E.cn)("mr-2 h-4 w-4",a.code===e.account?"opacity-100":"opacity-0")}),a.code," - ",a.name]},a.id))})]})]})})]})}),(0,t.jsx)(s.TableCell,{children:(0,t.jsx)(h.Input,{value:e.description,onChange:t=>Y(e.id,"description",t.target.value),placeholder:"Descripción del asiento",disabled:!ei})}),(0,t.jsx)(s.TableCell,{children:(0,t.jsx)(h.Input,{type:"number",className:"text-right",value:e.debit,onChange:t=>Y(e.id,"debit",parseFloat(t.target.value)||0),disabled:!ei})}),(0,t.jsx)(s.TableCell,{children:(0,t.jsx)(h.Input,{type:"number",className:"text-right",value:e.credit,onChange:t=>Y(e.id,"credit",parseFloat(t.target.value)||0),disabled:!ei})}),(0,t.jsx)(s.TableCell,{children:(0,t.jsx)(o.Button,{variant:"ghost",size:"icon",className:"text-destructive",onClick:()=>{var t;return t=e.id,void V(U.filter(e=>e.id!==t))},disabled:!ei,children:(0,t.jsx)(i.Trash2,{className:"h-4 w-4"})})})]},e.id)),0===U.length&&(0,t.jsx)(s.TableRow,{children:(0,t.jsx)(s.TableCell,{colSpan:5,className:"text-center h-24",children:"No hay asientos contables. Agrega uno para empezar."})})]}),(0,t.jsxs)(s.TableFooter,{children:[(0,t.jsxs)(s.TableRow,{children:[(0,t.jsx)(s.TableCell,{colSpan:2,children:(0,t.jsxs)(o.Button,{size:"sm",variant:"outline",className:"gap-1",onClick:()=>{let e=`new-entry-${Date.now()}-${Math.random()}`;V([...U,{id:e,account:"",description:"",debit:0,credit:0}]),W(t=>({...t,[e]:!1}))},disabled:!ei,children:[(0,t.jsx)(n.PlusCircle,{className:"h-4 w-4"}),"Agregar Línea"]})}),(0,t.jsxs)(s.TableCell,{className:"text-right font-bold text-lg",children:["$",Math.round(ea).toLocaleString("es-CL")]}),(0,t.jsxs)(s.TableCell,{className:"text-right font-bold text-lg",children:["$",Math.round(er).toLocaleString("es-CL")]}),(0,t.jsx)(s.TableCell,{})]}),(0,t.jsxs)(s.TableRow,{children:[(0,t.jsx)(s.TableCell,{colSpan:2}),(0,t.jsx)(s.TableCell,{className:"text-right font-bold",colSpan:2,children:eo&&0!==ea?(0,t.jsx)("span",{className:"text-green-600",children:"Comprobante Cuadrado"}):(0,t.jsxs)("span",{className:"text-destructive",children:["Diferencia: $",(ea-er).toLocaleString("es-CL")]})}),(0,t.jsx)(s.TableCell,{})]})]})]})]}),(0,t.jsxs)(r.CardFooter,{className:"flex justify-end items-center gap-2 pt-6",children:[!es&&(0,t.jsx)(I,{items:Z}),(0,t.jsx)(o.Button,{variant:"outline",asChild:!0,children:(0,t.jsx)(w.default,{href:"/dashboard/vouchers",children:"Cancelar"})}),(0,t.jsx)(o.Button,{disabled:!es,onClick:en,children:"Guardar Comprobante"})]})]})})}e.s(["default",()=>F])}]);