(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(75157);let l=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("div",{ref:l,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));l.displayName="Card";let o=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("div",{ref:l,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",e),...t}));o.displayName="CardHeader";let s=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("div",{ref:l,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));s.displayName="CardTitle";let n=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("div",{ref:l,className:(0,r.cn)("text-sm text-muted-foreground",e),...t}));n.displayName="CardDescription";let i=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("div",{ref:l,className:(0,r.cn)("p-6 pt-0",e),...t}));i.displayName="CardContent";let d=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("div",{ref:l,className:(0,r.cn)("flex items-center p-6 pt-0",e),...t}));d.displayName="CardFooter",e.s(["Card",()=>l,"CardContent",()=>i,"CardDescription",()=>n,"CardFooter",()=>d,"CardHeader",()=>o,"CardTitle",()=>s])},84774,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(75157);let l=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:l,className:(0,r.cn)("w-full caption-bottom text-sm",e),...t})}));l.displayName="Table";let o=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("thead",{ref:l,className:(0,r.cn)("[&_tr]:border-b",e),...t}));o.displayName="TableHeader";let s=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("tbody",{ref:l,className:(0,r.cn)("[&_tr:last-child]:border-0",e),...t}));s.displayName="TableBody";let n=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("tfoot",{ref:l,className:(0,r.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));n.displayName="TableFooter";let i=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("tr",{ref:l,className:(0,r.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));i.displayName="TableRow";let d=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("th",{ref:l,className:(0,r.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));d.displayName="TableHead";let c=t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("td",{ref:l,className:(0,r.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));c.displayName="TableCell",t.forwardRef(({className:e,...t},l)=>(0,a.jsx)("caption",{ref:l,className:(0,r.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption",e.s(["Table",()=>l,"TableBody",()=>s,"TableCell",()=>c,"TableFooter",()=>n,"TableHead",()=>d,"TableHeader",()=>o,"TableRow",()=>i])},97245,e=>{"use strict";var a=e.i(35684),t=e.i(96226);function r(e,r){let l=(0,a.toDate)(e);if(isNaN(r))return(0,t.constructFrom)(e,NaN);if(!r)return l;let o=l.getDate(),s=(0,t.constructFrom)(e,l.getTime());return(s.setMonth(l.getMonth()+r+1,0),o>=s.getDate())?s:(l.setFullYear(s.getFullYear(),s.getMonth(),o),l)}e.s(["addMonths",()=>r])},39189,e=>{"use strict";var a=e.i(35684),t=e.i(96226);function r(e,r){let l=(0,a.toDate)(e);return isNaN(r)?(0,t.constructFrom)(e,NaN):(r&&l.setDate(l.getDate()+r),l)}e.s(["addDays",()=>r])},37822,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(81140),l=e.i(20783),o=e.i(30030),s=e.i(26330),n=e.i(3536),i=e.i(65491),d=e.i(10772),c=e.i(53660),u=e.i(74606),f=e.i(96626),h=e.i(48425),p=e.i(91918),m=e.i(69340),x=e.i(86312),b=e.i(85369),g="Popover",[j,v]=(0,o.createContextScope)(g,[c.createPopperScope]),C=(0,c.createPopperScope)(),[N,T]=j(g),w=e=>{let{__scopePopover:r,children:l,open:o,defaultOpen:s,onOpenChange:n,modal:i=!1}=e,u=C(r),f=t.useRef(null),[h,p]=t.useState(!1),[x,b]=(0,m.useControllableState)({prop:o,defaultProp:s??!1,onChange:n,caller:g});return(0,a.jsx)(c.Root,{...u,children:(0,a.jsx)(N,{scope:r,contentId:(0,d.useId)(),triggerRef:f,open:x,onOpenChange:b,onOpenToggle:t.useCallback(()=>b(e=>!e),[b]),hasCustomAnchor:h,onCustomAnchorAdd:t.useCallback(()=>p(!0),[]),onCustomAnchorRemove:t.useCallback(()=>p(!1),[]),modal:i,children:l})})};w.displayName=g;var y="PopoverAnchor";t.forwardRef((e,r)=>{let{__scopePopover:l,...o}=e,s=T(y,l),n=C(l),{onCustomAnchorAdd:i,onCustomAnchorRemove:d}=s;return t.useEffect(()=>(i(),()=>d()),[i,d]),(0,a.jsx)(c.Anchor,{...n,...o,ref:r})}).displayName=y;var R="PopoverTrigger",P=t.forwardRef((e,t)=>{let{__scopePopover:o,...s}=e,n=T(R,o),i=C(o),d=(0,l.useComposedRefs)(t,n.triggerRef),u=(0,a.jsx)(h.Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":$(n.open),...s,ref:d,onClick:(0,r.composeEventHandlers)(e.onClick,n.onOpenToggle)});return n.hasCustomAnchor?u:(0,a.jsx)(c.Anchor,{asChild:!0,...i,children:u})});P.displayName=R;var D="PopoverPortal",[F,B]=j(D,{forceMount:void 0}),A=e=>{let{__scopePopover:t,forceMount:r,children:l,container:o}=e,s=T(D,t);return(0,a.jsx)(F,{scope:t,forceMount:r,children:(0,a.jsx)(f.Presence,{present:r||s.open,children:(0,a.jsx)(u.Portal,{asChild:!0,container:o,children:l})})})};A.displayName=D;var L="PopoverContent",S=t.forwardRef((e,t)=>{let r=B(L,e.__scopePopover),{forceMount:l=r.forceMount,...o}=e,s=T(L,e.__scopePopover);return(0,a.jsx)(f.Presence,{present:l||s.open,children:s.modal?(0,a.jsx)(M,{...o,ref:t}):(0,a.jsx)(E,{...o,ref:t})})});S.displayName=L;var H=(0,p.createSlot)("PopoverContent.RemoveScroll"),M=t.forwardRef((e,o)=>{let s=T(L,e.__scopePopover),n=t.useRef(null),i=(0,l.useComposedRefs)(o,n),d=t.useRef(!1);return t.useEffect(()=>{let e=n.current;if(e)return(0,x.hideOthers)(e)},[]),(0,a.jsx)(b.RemoveScroll,{as:H,allowPinchZoom:!0,children:(0,a.jsx)(O,{...e,ref:i,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,r.composeEventHandlers)(e.onCloseAutoFocus,e=>{e.preventDefault(),d.current||s.triggerRef.current?.focus()}),onPointerDownOutside:(0,r.composeEventHandlers)(e.onPointerDownOutside,e=>{let a=e.detail.originalEvent,t=0===a.button&&!0===a.ctrlKey;d.current=2===a.button||t},{checkForDefaultPrevented:!1}),onFocusOutside:(0,r.composeEventHandlers)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),E=t.forwardRef((e,r)=>{let l=T(L,e.__scopePopover),o=t.useRef(!1),s=t.useRef(!1);return(0,a.jsx)(O,{...e,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{e.onCloseAutoFocus?.(a),a.defaultPrevented||(o.current||l.triggerRef.current?.focus(),a.preventDefault()),o.current=!1,s.current=!1},onInteractOutside:a=>{e.onInteractOutside?.(a),a.defaultPrevented||(o.current=!0,"pointerdown"===a.detail.originalEvent.type&&(s.current=!0));let t=a.target;l.triggerRef.current?.contains(t)&&a.preventDefault(),"focusin"===a.detail.originalEvent.type&&s.current&&a.preventDefault()}})}),O=t.forwardRef((e,t)=>{let{__scopePopover:r,trapFocus:l,onOpenAutoFocus:o,onCloseAutoFocus:d,disableOutsidePointerEvents:u,onEscapeKeyDown:f,onPointerDownOutside:h,onFocusOutside:p,onInteractOutside:m,...x}=e,b=T(L,r),g=C(r);return(0,n.useFocusGuards)(),(0,a.jsx)(i.FocusScope,{asChild:!0,loop:!0,trapped:l,onMountAutoFocus:o,onUnmountAutoFocus:d,children:(0,a.jsx)(s.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:u,onInteractOutside:m,onEscapeKeyDown:f,onPointerDownOutside:h,onFocusOutside:p,onDismiss:()=>b.onOpenChange(!1),children:(0,a.jsx)(c.Content,{"data-state":$(b.open),role:"dialog",id:b.contentId,...g,...x,ref:t,style:{...x.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),k="PopoverClose";function $(e){return e?"open":"closed"}t.forwardRef((e,t)=>{let{__scopePopover:l,...o}=e,s=T(k,l);return(0,a.jsx)(h.Primitive.button,{type:"button",...o,ref:t,onClick:(0,r.composeEventHandlers)(e.onClick,()=>s.onOpenChange(!1))})}).displayName=k,t.forwardRef((e,t)=>{let{__scopePopover:r,...l}=e,o=C(r);return(0,a.jsx)(c.Arrow,{...o,...l,ref:t})}).displayName="PopoverArrow";var _=e.i(75157);let q=t.forwardRef(({className:e,align:t="center",sideOffset:r=4,...l},o)=>(0,a.jsx)(A,{children:(0,a.jsx)(S,{ref:o,align:t,sideOffset:r,className:(0,_.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...l})}));q.displayName=S.displayName,e.s(["Popover",()=>w,"PopoverContent",()=>q,"PopoverTrigger",()=>P],37822)},38815,e=>{"use strict";var a=e.i(35684);function t(e,t){return+(0,a.toDate)(e)<+(0,a.toDate)(t)}e.s(["isBefore",()=>t])},88515,e=>{"use strict";var a=e.i(35684);function t(e){let t=(0,a.toDate)(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(0,0,0,0),t}e.s(["lastDayOfMonth",()=>t])},16340,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(45919),l=e.i(43104),o=e.i(87316),s=e.i(75157),n=e.i(19455),i=e.i(27766),d=e.i(37822);function c({className:e,date:c,onDateChange:u}){let[f,h]=t.useState(c);return t.useEffect(()=>{h(c)},[c]),(0,a.jsx)("div",{className:(0,s.cn)("grid gap-2",e),children:(0,a.jsxs)(d.Popover,{children:[(0,a.jsx)(d.PopoverTrigger,{asChild:!0,children:(0,a.jsxs)(n.Button,{id:"date",variant:"outline",className:(0,s.cn)("w-full justify-start text-left font-normal",!f&&"text-muted-foreground"),children:[(0,a.jsx)(o.Calendar,{className:"mr-2 h-4 w-4"}),f?.from?f.to?(0,a.jsxs)(a.Fragment,{children:[(0,r.format)(f.from,"LLL dd, y",{locale:l.es})," -"," ",(0,r.format)(f.to,"LLL dd, y",{locale:l.es})]}):(0,r.format)(f.from,"LLL dd, y",{locale:l.es}):(0,a.jsx)("span",{children:"Selecciona un rango de fechas"})]})}),(0,a.jsx)(d.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,a.jsx)(i.Calendar,{initialFocus:!0,mode:"range",defaultMonth:f?.from,selected:f,onSelect:e=>{h(e),u&&u(e)},numberOfMonths:2,locale:l.es})})]})})}e.s(["DateRangePicker",()=>c])},84132,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(15288),l=e.i(19455),o=e.i(16340);e.i(11981);var s=e.i(80428),n=e.i(61480),i=e.i(84774),d=e.i(45919),c=e.i(43104),u=e.i(39126);e.i(36180);var f=e.i(17875);function h(){let{selectedCompany:e}=t.default.useContext(u.SelectedCompanyContext)||{},h=e?.id,p=(0,n.useFirestore)(),[m,x]=t.default.useState({from:new Date(new Date().getFullYear(),0,1),to:new Date(new Date().getFullYear(),11,31)}),[b,g]=t.default.useState(null),{data:j,loading:v}=(0,s.useCollection)({path:h?`companies/${h}/accounts`:void 0,companyId:h}),C=t.default.useMemo(()=>p&&h?(0,f.query)((0,f.collection)(p,`companies/${h}/vouchers`),(0,f.where)("status","==","Contabilizado")):null,[p,h]),{data:N,loading:T}=(0,s.useCollection)({query:C,disabled:!C}),w=v||T;return(0,a.jsxs)("div",{className:"grid gap-6",children:[(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{children:[(0,a.jsx)(r.CardTitle,{children:"Balance General"}),(0,a.jsx)(r.CardDescription,{children:"Consulta el balance general de la empresa para un período específico. Solo se considerarán comprobantes contabilizados."})]}),(0,a.jsx)(r.CardContent,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-end max-w-lg",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(o.DateRangePicker,{date:m,onDateChange:x})}),(0,a.jsx)(l.Button,{onClick:()=>{if(!j||!N||!m?.from||!m?.to)return void g(null);let e=m.from,a=m.to,t=N.filter(t=>{let r=new Date(t.date);return r>=e&&r<=a}),r=new Map;j.forEach(e=>{r.set(e.code,{initialBalance:e.balance||0,debit:0,credit:0})}),t.forEach(e=>{e.entries.forEach(e=>{if(r.has(e.account)){let a=r.get(e.account);a.debit+=Number(e.debit)||0,a.credit+=Number(e.credit)||0}})});let l=j.map(e=>{let a=r.get(e.code),t=a.initialBalance;return"Activo"===e.type||"Resultado"===e.type&&a.debit>a.credit?t+=a.debit-a.credit:t+=a.credit-a.debit,{...e,finalBalance:t}}),o=new Map(l.map(e=>[e.code,e.finalBalance]));Array.from(o.keys()).sort((e,a)=>a.length-e.length).forEach(e=>{let a="";if(e.length>1&&(e.length>5?a=e.substring(0,5):5===e.length?a=e.substring(0,3):3===e.length&&(a=e.substring(0,1))),a&&o.has(a)){let t=o.get(a);o.set(a,t+o.get(e))}});let s=l.map(e=>({...e,finalBalance:o.get(e.code)})),n=s.filter(e=>e.code.startsWith("1")&&0!==e.finalBalance),i=s.filter(e=>e.code.startsWith("2")&&0!==e.finalBalance),d=s.filter(e=>e.code.startsWith("3")&&0!==e.finalBalance),c=s.filter(e=>e.code.startsWith("4")),u=s.filter(e=>e.code.startsWith("5")||e.code.startsWith("6")),f=c.reduce((e,a)=>e+a.finalBalance,0)-u.reduce((e,a)=>e+a.finalBalance,0);g({assets:n,liabilities:i,equity:d,periodResult:f,totalAssets:s.find(e=>"1"===e.code)?.finalBalance||0,totalLiabilitiesAndEquity:(s.find(e=>"2"===e.code)?.finalBalance||0)+(s.find(e=>"3"===e.code)?.finalBalance||0)+f})},disabled:w||!h,children:w?"Cargando...":"Generar Balance"})]})})]}),b&&(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{children:[(0,a.jsx)(r.CardTitle,{children:"Balance General"}),(0,a.jsx)(r.CardDescription,{children:m?.from&&m.to?`Para el per\xedodo del ${(0,d.format)(m.from,"P",{locale:c.es})} al ${(0,d.format)(m.to,"P",{locale:c.es})}`:""})]}),(0,a.jsxs)(r.CardContent,{className:"grid md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-bold text-lg mb-2",children:"Activos"}),(0,a.jsxs)(i.Table,{children:[(0,a.jsx)(i.TableHeader,{children:(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableHead,{children:"Cuenta"}),(0,a.jsx)(i.TableHead,{className:"text-right",children:"Saldo"})]})}),(0,a.jsx)(i.TableBody,{children:b.assets.map(e=>(0,a.jsxs)(i.TableRow,{children:[(0,a.jsxs)(i.TableCell,{children:[e.code," - ",e.name]}),(0,a.jsxs)(i.TableCell,{className:"text-right",children:["$",Math.round(e.finalBalance).toLocaleString("es-CL")]})]},e.id))}),(0,a.jsx)(i.TableFooter,{children:(0,a.jsxs)(i.TableRow,{className:"font-bold text-base",children:[(0,a.jsx)(i.TableCell,{children:"Total Activos"}),(0,a.jsxs)(i.TableCell,{className:"text-right",children:["$",Math.round(b.totalAssets).toLocaleString("es-CL")]})]})})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-bold text-lg mb-2",children:"Pasivos"}),(0,a.jsxs)(i.Table,{children:[(0,a.jsx)(i.TableHeader,{children:(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableHead,{children:"Cuenta"}),(0,a.jsx)(i.TableHead,{className:"text-right",children:"Saldo"})]})}),(0,a.jsx)(i.TableBody,{children:b.liabilities.map(e=>(0,a.jsxs)(i.TableRow,{children:[(0,a.jsxs)(i.TableCell,{children:[e.code," - ",e.name]}),(0,a.jsxs)(i.TableCell,{className:"text-right",children:["$",Math.round(e.finalBalance).toLocaleString("es-CL")]})]},e.id))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-bold text-lg mb-2",children:"Patrimonio"}),(0,a.jsxs)(i.Table,{children:[(0,a.jsx)(i.TableHeader,{children:(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableHead,{children:"Cuenta"}),(0,a.jsx)(i.TableHead,{className:"text-right",children:"Saldo"})]})}),(0,a.jsxs)(i.TableBody,{children:[b.equity.map(e=>(0,a.jsxs)(i.TableRow,{children:[(0,a.jsxs)(i.TableCell,{children:[e.code," - ",e.name]}),(0,a.jsxs)(i.TableCell,{className:"text-right",children:["$",Math.round(e.finalBalance).toLocaleString("es-CL")]})]},e.id)),(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableCell,{children:"Resultado del Período"}),(0,a.jsxs)(i.TableCell,{className:"text-right",children:["$",Math.round(b.periodResult).toLocaleString("es-CL")]})]})]})]})]}),(0,a.jsx)(i.Table,{children:(0,a.jsx)(i.TableFooter,{children:(0,a.jsxs)(i.TableRow,{className:"font-bold text-base bg-muted",children:[(0,a.jsx)(i.TableCell,{children:"Total Pasivo y Patrimonio"}),(0,a.jsxs)(i.TableCell,{className:"text-right",children:["$",Math.round(b.totalLiabilitiesAndEquity).toLocaleString("es-CL")]})]})})})]})]}),(0,a.jsx)(r.CardFooter,{children:(0,a.jsx)("p",{className:`text-sm font-bold ${Math.round(b.totalAssets)===Math.round(b.totalLiabilitiesAndEquity)?"text-green-600":"text-destructive"}`,children:Math.round(b.totalAssets)===Math.round(b.totalLiabilitiesAndEquity)?"La Ecuación Contable está balanceada.":"La Ecuación Contable no está balanceada."})})]}),!b&&!w&&(0,a.jsxs)(r.Card,{children:[(0,a.jsx)(r.CardHeader,{children:(0,a.jsx)(r.CardTitle,{children:"Balance No Generado"})}),(0,a.jsx)(r.CardContent,{children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:'Selecciona un período y haz clic en "Generar Balance" para visualizar el informe.'})})]})]})}e.s(["default",()=>h])}]);