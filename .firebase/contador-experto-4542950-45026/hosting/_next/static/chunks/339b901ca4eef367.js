(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(75157);let o=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{ref:o,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...a}));o.displayName="Card";let l=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{ref:o,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",e),...a}));l.displayName="CardHeader";let n=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{ref:o,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",e),...a}));n.displayName="CardTitle";let s=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{ref:o,className:(0,r.cn)("text-sm text-muted-foreground",e),...a}));s.displayName="CardDescription";let i=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{ref:o,className:(0,r.cn)("p-6 pt-0",e),...a}));i.displayName="CardContent";let d=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{ref:o,className:(0,r.cn)("flex items-center p-6 pt-0",e),...a}));d.displayName="CardFooter",e.s(["Card",()=>o,"CardContent",()=>i,"CardDescription",()=>s,"CardFooter",()=>d,"CardHeader",()=>l,"CardTitle",()=>n])},84774,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(75157);let o=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:o,className:(0,r.cn)("w-full caption-bottom text-sm",e),...a})}));o.displayName="Table";let l=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("thead",{ref:o,className:(0,r.cn)("[&_tr]:border-b",e),...a}));l.displayName="TableHeader";let n=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("tbody",{ref:o,className:(0,r.cn)("[&_tr:last-child]:border-0",e),...a}));n.displayName="TableBody";let s=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("tfoot",{ref:o,className:(0,r.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a}));s.displayName="TableFooter";let i=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("tr",{ref:o,className:(0,r.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a}));i.displayName="TableRow";let d=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("th",{ref:o,className:(0,r.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...a}));d.displayName="TableHead";let c=a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("td",{ref:o,className:(0,r.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...a}));c.displayName="TableCell",a.forwardRef(({className:e,...a},o)=>(0,t.jsx)("caption",{ref:o,className:(0,r.cn)("mt-4 text-sm text-muted-foreground",e),...a})).displayName="TableCaption",e.s(["Table",()=>o,"TableBody",()=>n,"TableCell",()=>c,"TableFooter",()=>s,"TableHead",()=>d,"TableHeader",()=>l,"TableRow",()=>i])},97245,e=>{"use strict";var t=e.i(35684),a=e.i(96226);function r(e,r){let o=(0,t.toDate)(e);if(isNaN(r))return(0,a.constructFrom)(e,NaN);if(!r)return o;let l=o.getDate(),n=(0,a.constructFrom)(e,o.getTime());return(n.setMonth(o.getMonth()+r+1,0),l>=n.getDate())?n:(o.setFullYear(n.getFullYear(),n.getMonth(),l),o)}e.s(["addMonths",()=>r])},39189,e=>{"use strict";var t=e.i(35684),a=e.i(96226);function r(e,r){let o=(0,t.toDate)(e);return isNaN(r)?(0,a.constructFrom)(e,NaN):(r&&o.setDate(o.getDate()+r),o)}e.s(["addDays",()=>r])},37822,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(81140),o=e.i(20783),l=e.i(30030),n=e.i(26330),s=e.i(3536),i=e.i(65491),d=e.i(10772),c=e.i(53660),u=e.i(74606),f=e.i(96626),p=e.i(48425),m=e.i(91918),h=e.i(69340),x=e.i(86312),b=e.i(85369),g="Popover",[v,C]=(0,l.createContextScope)(g,[c.createPopperScope]),j=(0,c.createPopperScope)(),[N,w]=v(g),y=e=>{let{__scopePopover:r,children:o,open:l,defaultOpen:n,onOpenChange:s,modal:i=!1}=e,u=j(r),f=a.useRef(null),[p,m]=a.useState(!1),[x,b]=(0,h.useControllableState)({prop:l,defaultProp:n??!1,onChange:s,caller:g});return(0,t.jsx)(c.Root,{...u,children:(0,t.jsx)(N,{scope:r,contentId:(0,d.useId)(),triggerRef:f,open:x,onOpenChange:b,onOpenToggle:a.useCallback(()=>b(e=>!e),[b]),hasCustomAnchor:p,onCustomAnchorAdd:a.useCallback(()=>m(!0),[]),onCustomAnchorRemove:a.useCallback(()=>m(!1),[]),modal:i,children:o})})};y.displayName=g;var T="PopoverAnchor";a.forwardRef((e,r)=>{let{__scopePopover:o,...l}=e,n=w(T,o),s=j(o),{onCustomAnchorAdd:i,onCustomAnchorRemove:d}=n;return a.useEffect(()=>(i(),()=>d()),[i,d]),(0,t.jsx)(c.Anchor,{...s,...l,ref:r})}).displayName=T;var R="PopoverTrigger",P=a.forwardRef((e,a)=>{let{__scopePopover:l,...n}=e,s=w(R,l),i=j(l),d=(0,o.useComposedRefs)(a,s.triggerRef),u=(0,t.jsx)(p.Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":$(s.open),...n,ref:d,onClick:(0,r.composeEventHandlers)(e.onClick,s.onOpenToggle)});return s.hasCustomAnchor?u:(0,t.jsx)(c.Anchor,{asChild:!0,...i,children:u})});P.displayName=R;var D="PopoverPortal",[F,S]=v(D,{forceMount:void 0}),B=e=>{let{__scopePopover:a,forceMount:r,children:o,container:l}=e,n=w(D,a);return(0,t.jsx)(F,{scope:a,forceMount:r,children:(0,t.jsx)(f.Presence,{present:r||n.open,children:(0,t.jsx)(u.Portal,{asChild:!0,container:l,children:o})})})};B.displayName=D;var A="PopoverContent",H=a.forwardRef((e,a)=>{let r=S(A,e.__scopePopover),{forceMount:o=r.forceMount,...l}=e,n=w(A,e.__scopePopover);return(0,t.jsx)(f.Presence,{present:o||n.open,children:n.modal?(0,t.jsx)(L,{...l,ref:a}):(0,t.jsx)(O,{...l,ref:a})})});H.displayName=A;var M=(0,m.createSlot)("PopoverContent.RemoveScroll"),L=a.forwardRef((e,l)=>{let n=w(A,e.__scopePopover),s=a.useRef(null),i=(0,o.useComposedRefs)(l,s),d=a.useRef(!1);return a.useEffect(()=>{let e=s.current;if(e)return(0,x.hideOthers)(e)},[]),(0,t.jsx)(b.RemoveScroll,{as:M,allowPinchZoom:!0,children:(0,t.jsx)(E,{...e,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,r.composeEventHandlers)(e.onCloseAutoFocus,e=>{e.preventDefault(),d.current||n.triggerRef.current?.focus()}),onPointerDownOutside:(0,r.composeEventHandlers)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,a=0===t.button&&!0===t.ctrlKey;d.current=2===t.button||a},{checkForDefaultPrevented:!1}),onFocusOutside:(0,r.composeEventHandlers)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),O=a.forwardRef((e,r)=>{let o=w(A,e.__scopePopover),l=a.useRef(!1),n=a.useRef(!1);return(0,t.jsx)(E,{...e,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(l.current||o.triggerRef.current?.focus(),t.preventDefault()),l.current=!1,n.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(l.current=!0,"pointerdown"===t.detail.originalEvent.type&&(n.current=!0));let a=t.target;o.triggerRef.current?.contains(a)&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&n.current&&t.preventDefault()}})}),E=a.forwardRef((e,a)=>{let{__scopePopover:r,trapFocus:o,onOpenAutoFocus:l,onCloseAutoFocus:d,disableOutsidePointerEvents:u,onEscapeKeyDown:f,onPointerDownOutside:p,onFocusOutside:m,onInteractOutside:h,...x}=e,b=w(A,r),g=j(r);return(0,s.useFocusGuards)(),(0,t.jsx)(i.FocusScope,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:l,onUnmountAutoFocus:d,children:(0,t.jsx)(n.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:u,onInteractOutside:h,onEscapeKeyDown:f,onPointerDownOutside:p,onFocusOutside:m,onDismiss:()=>b.onOpenChange(!1),children:(0,t.jsx)(c.Content,{"data-state":$(b.open),role:"dialog",id:b.contentId,...g,...x,ref:a,style:{...x.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),k="PopoverClose";function $(e){return e?"open":"closed"}a.forwardRef((e,a)=>{let{__scopePopover:o,...l}=e,n=w(k,o);return(0,t.jsx)(p.Primitive.button,{type:"button",...l,ref:a,onClick:(0,r.composeEventHandlers)(e.onClick,()=>n.onOpenChange(!1))})}).displayName=k,a.forwardRef((e,a)=>{let{__scopePopover:r,...o}=e,l=j(r);return(0,t.jsx)(c.Arrow,{...l,...o,ref:a})}).displayName="PopoverArrow";var _=e.i(75157);let I=a.forwardRef(({className:e,align:a="center",sideOffset:r=4,...o},l)=>(0,t.jsx)(B,{children:(0,t.jsx)(H,{ref:l,align:a,sideOffset:r,className:(0,_.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...o})}));I.displayName=H.displayName,e.s(["Popover",()=>y,"PopoverContent",()=>I,"PopoverTrigger",()=>P],37822)},38815,e=>{"use strict";var t=e.i(35684);function a(e,a){return+(0,t.toDate)(e)<+(0,t.toDate)(a)}e.s(["isBefore",()=>a])},88515,e=>{"use strict";var t=e.i(35684);function a(e){let a=(0,t.toDate)(e),r=a.getMonth();return a.setFullYear(a.getFullYear(),r+1,0),a.setHours(0,0,0,0),a}e.s(["lastDayOfMonth",()=>a])},16340,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(45919),o=e.i(43104),l=e.i(87316),n=e.i(75157),s=e.i(19455),i=e.i(27766),d=e.i(37822);function c({className:e,date:c,onDateChange:u}){let[f,p]=a.useState(c);return a.useEffect(()=>{p(c)},[c]),(0,t.jsx)("div",{className:(0,n.cn)("grid gap-2",e),children:(0,t.jsxs)(d.Popover,{children:[(0,t.jsx)(d.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(s.Button,{id:"date",variant:"outline",className:(0,n.cn)("w-full justify-start text-left font-normal",!f&&"text-muted-foreground"),children:[(0,t.jsx)(l.Calendar,{className:"mr-2 h-4 w-4"}),f?.from?f.to?(0,t.jsxs)(t.Fragment,{children:[(0,r.format)(f.from,"LLL dd, y",{locale:o.es})," -"," ",(0,r.format)(f.to,"LLL dd, y",{locale:o.es})]}):(0,r.format)(f.from,"LLL dd, y",{locale:o.es}):(0,t.jsx)("span",{children:"Selecciona un rango de fechas"})]})}),(0,t.jsx)(d.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(i.Calendar,{initialFocus:!0,mode:"range",defaultMonth:f?.from,selected:f,onSelect:e=>{p(e),u&&u(e)},numberOfMonths:2,locale:o.es})})]})})}e.s(["DateRangePicker",()=>c])},69614,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(15288),o=e.i(19455),l=e.i(16340),n=e.i(84774),s=e.i(45919),i=e.i(43104);e.i(11981);var d=e.i(80428),c=e.i(61480),u=e.i(39126);e.i(36180);var f=e.i(17875);function p(){let{selectedCompany:e}=a.default.useContext(u.SelectedCompanyContext)||{},p=e?.id,m=(0,c.useFirestore)(),[h,x]=a.default.useState({from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date(new Date().getFullYear(),new Date().getMonth()+1,0)}),[b,g]=a.default.useState(null),{data:v,loading:C}=(0,d.useCollection)({path:p?`companies/${p}/accounts`:void 0,companyId:p}),j=a.default.useMemo(()=>m&&p?(0,f.query)((0,f.collection)(m,`companies/${p}/vouchers`),(0,f.where)("status","==","Contabilizado")):null,[m,p]),{data:N,loading:w}=(0,d.useCollection)({query:j,disabled:!j}),y=C||w,T=a.default.useMemo(()=>b?b.filter(e=>1===e.code.length).reduce((e,t)=>({debit:e.debit+t.debit,credit:e.credit+t.credit}),{debit:0,credit:0}):{debit:0,credit:0},[b]);return(0,t.jsxs)("div",{className:"grid gap-6",children:[(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)(r.CardHeader,{children:[(0,t.jsx)(r.CardTitle,{children:"Balance de Comprobación y Saldos"}),(0,t.jsx)(r.CardDescription,{children:"Selecciona un período para generar un balance contable. Solo se considerarán comprobantes contabilizados."})]}),(0,t.jsx)(r.CardContent,{className:"space-y-4",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-end",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(l.DateRangePicker,{date:h,onDateChange:x})}),(0,t.jsx)(o.Button,{onClick:()=>{if(!v||!N||!h?.from||!h?.to)return void g([]);let e=h.from,t=h.to,a=N.filter(a=>{let r=new Date(a.date);return r>=e&&r<=t}),r=new Map;v.forEach(e=>{r.set(e.code,{code:e.code,name:e.name,initialBalance:e.balance||0,debit:0,credit:0,finalBalance:0})}),a.forEach(e=>{e.entries.forEach(e=>{if(r.has(e.account)){let t=r.get(e.account);t.debit+=Number(e.debit)||0,t.credit+=Number(e.credit)||0}})});let o=Array.from(r.keys()).sort((e,t)=>e.localeCompare(t,void 0,{numeric:!0}));o.forEach(e=>{let t=r.get(e),a=v.find(t=>t.code===e);a?.type==="Activo"||a?.type==="Resultado"&&t.debit>t.credit?t.finalBalance=t.initialBalance+t.debit-t.credit:t.finalBalance=t.initialBalance+t.credit-t.debit});for(let e=o.length-1;e>=0;e--){let t=o[e],a="";if(t.length>1&&(t.length>5?a=t.substring(0,5):5===t.length?a=t.substring(0,3):3===t.length&&(a=t.substring(0,1))),a&&r.has(a)){let e=r.get(t),o=r.get(a);o.debit+=e.debit,o.credit+=e.credit}}o.forEach(e=>{if(e.length<6){let t=r.get(e),a=v.find(t=>t.code===e);a?.type==="Activo"||a?.type==="Resultado"?t.finalBalance=t.initialBalance+t.debit-t.credit:t.finalBalance=t.initialBalance+t.credit-t.debit}}),g(o.map(e=>r.get(e)).filter(e=>0!==e.initialBalance||0!==e.debit||0!==e.credit||0!==e.finalBalance))},disabled:y||!p,children:y?"Cargando...":"Generar Balance"})]})})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)(r.CardHeader,{children:[(0,t.jsx)(r.CardTitle,{children:"Último Balance Generado"}),(0,t.jsx)(r.CardDescription,{children:b&&h?.from&&h?.to?`Balance para el per\xedodo del ${(0,s.format)(h.from,"P",{locale:i.es})} al ${(0,s.format)(h.to,"P",{locale:i.es})}.`:p?"Aún no se ha generado ningún balance.":"Por favor, selecciona una empresa."})]}),(0,t.jsx)(r.CardContent,{children:b?(0,t.jsxs)(n.Table,{children:[(0,t.jsx)(n.TableHeader,{children:(0,t.jsxs)(n.TableRow,{children:[(0,t.jsx)(n.TableHead,{children:"Código"}),(0,t.jsx)(n.TableHead,{children:"Cuenta"}),(0,t.jsx)(n.TableHead,{className:"text-right",children:"Debe"}),(0,t.jsx)(n.TableHead,{className:"text-right",children:"Haber"}),(0,t.jsx)(n.TableHead,{className:"text-right font-bold",children:"Saldo"})]})}),(0,t.jsxs)(n.TableBody,{children:[0===b.length&&(0,t.jsx)(n.TableRow,{children:(0,t.jsx)(n.TableCell,{colSpan:5,className:"text-center",children:"No hay movimientos en el período seleccionado."})}),b.map(e=>(0,t.jsxs)(n.TableRow,{children:[(0,t.jsx)(n.TableCell,{children:e.code}),(0,t.jsx)(n.TableCell,{children:e.name}),(0,t.jsxs)(n.TableCell,{className:"text-right",children:["$",Math.round(e.debit).toLocaleString("es-CL")]}),(0,t.jsxs)(n.TableCell,{className:"text-right",children:["$",Math.round(e.credit).toLocaleString("es-CL")]}),(0,t.jsxs)(n.TableCell,{className:`text-right font-bold ${e.finalBalance<0?"text-destructive":""}`,children:["$",Math.round(e.finalBalance).toLocaleString("es-CL")]})]},e.code))]}),(0,t.jsx)(n.TableFooter,{children:(0,t.jsxs)(n.TableRow,{className:"text-base",children:[(0,t.jsx)(n.TableCell,{colSpan:2,className:"font-bold",children:"Totales"}),(0,t.jsxs)(n.TableCell,{className:"text-right font-bold",children:["$",Math.round(T.debit).toLocaleString("es-CL")]}),(0,t.jsxs)(n.TableCell,{className:"text-right font-bold",children:["$",Math.round(T.credit).toLocaleString("es-CL")]}),(0,t.jsx)(n.TableCell,{})]})})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Utiliza el generador para crear tu primer balance."})})]})]})}e.s(["default",()=>p])}]);