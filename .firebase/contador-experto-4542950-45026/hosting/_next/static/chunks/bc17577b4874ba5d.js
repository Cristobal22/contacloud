(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var a=e.i(43476),l=e.i(71645),t=e.i(75157);let s=l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("div",{ref:s,className:(0,t.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...l}));s.displayName="Card";let r=l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("div",{ref:s,className:(0,t.cn)("flex flex-col space-y-1.5 p-6",e),...l}));r.displayName="CardHeader";let d=l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("div",{ref:s,className:(0,t.cn)("text-2xl font-semibold leading-none tracking-tight",e),...l}));d.displayName="CardTitle";let o=l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("div",{ref:s,className:(0,t.cn)("text-sm text-muted-foreground",e),...l}));o.displayName="CardDescription";let i=l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("div",{ref:s,className:(0,t.cn)("p-6 pt-0",e),...l}));i.displayName="CardContent";let c=l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("div",{ref:s,className:(0,t.cn)("flex items-center p-6 pt-0",e),...l}));c.displayName="CardFooter",e.s(["Card",()=>s,"CardContent",()=>i,"CardDescription",()=>o,"CardFooter",()=>c,"CardHeader",()=>r,"CardTitle",()=>d])},84774,e=>{"use strict";var a=e.i(43476),l=e.i(71645),t=e.i(75157);let s=l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:s,className:(0,t.cn)("w-full caption-bottom text-sm",e),...l})}));s.displayName="Table";let r=l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("thead",{ref:s,className:(0,t.cn)("[&_tr]:border-b",e),...l}));r.displayName="TableHeader";let d=l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("tbody",{ref:s,className:(0,t.cn)("[&_tr:last-child]:border-0",e),...l}));d.displayName="TableBody";let o=l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("tfoot",{ref:s,className:(0,t.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...l}));o.displayName="TableFooter";let i=l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("tr",{ref:s,className:(0,t.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...l}));i.displayName="TableRow";let c=l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("th",{ref:s,className:(0,t.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...l}));c.displayName="TableHead";let n=l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("td",{ref:s,className:(0,t.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...l}));n.displayName="TableCell",l.forwardRef(({className:e,...l},s)=>(0,a.jsx)("caption",{ref:s,className:(0,t.cn)("mt-4 text-sm text-muted-foreground",e),...l})).displayName="TableCaption",e.s(["Table",()=>s,"TableBody",()=>d,"TableCell",()=>n,"TableFooter",()=>o,"TableHead",()=>c,"TableHeader",()=>r,"TableRow",()=>i])},10204,e=>{"use strict";var a=e.i(43476),l=e.i(71645),t=e.i(48425),s=l.forwardRef((e,l)=>(0,a.jsx)(t.Primitive.label,{...e,ref:l,onMouseDown:a=>{a.target.closest("button, input, select, textarea")||(e.onMouseDown?.(a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));s.displayName="Label";var r=e.i(25913),d=e.i(75157);let o=(0,r.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),i=l.forwardRef(({className:e,...l},t)=>(0,a.jsx)(s,{ref:t,className:(0,d.cn)(o(),e),...l}));i.displayName=s.displayName,e.s(["Label",()=>i],10204)},22044,e=>{"use strict";var a=e.i(35684);function l(e){return(0,a.toDate)(e).getFullYear()}e.s(["getYear",()=>l])},56113,e=>{"use strict";var a=e.i(43476),l=e.i(71645),t=e.i(15288),s=e.i(19455),r=e.i(10204),d=e.i(55764),o=e.i(84774);e.i(11981);var i=e.i(80428),c=e.i(39126),n=e.i(45919),m=e.i(96354),x=e.i(28880),b=e.i(22044),h=e.i(43104),u=e.i(8406);let f=e=>0===e?"-":new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(e));function p(){let{selectedCompany:e}=l.default.useContext(c.SelectedCompanyContext)||{},p=e?.id,{toast:g}=(0,u.useToast)(),{data:j,loading:N}=(0,i.useCollection)({path:`companies/${p}/accounts`,companyId:p}),{data:T,loading:C}=(0,i.useCollection)({path:`companies/${p}/vouchers`,companyId:p}),[y,v]=l.default.useState(null),[w,D]=l.default.useState(!1),[H,R]=l.default.useState(()=>(0,n.format)((0,m.startOfMonth)(new Date),"yyyy-MM-dd")),[S,M]=l.default.useState(()=>(0,n.format)((0,x.endOfMonth)(new Date),"yyyy-MM-dd"));l.default.useEffect(()=>{if(e?.periodStartDate&&e?.periodEndDate){let a=new Date(e.periodStartDate),l=new Date(e.periodEndDate);isNaN(a.getTime())||isNaN(l.getTime())||(R((0,n.format)(a,"yyyy-MM-dd")),M((0,n.format)(l,"yyyy-MM-dd")))}},[e]);let A=e?.periodStartDate&&e?.periodEndDate,P=y?.resultadoDelEjercicio??0,k=P>=0;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(t.Card,{children:[(0,a.jsxs)(t.CardHeader,{children:[(0,a.jsx)(t.CardTitle,{children:"Balance de 8 Columnas"}),(0,a.jsx)(t.CardDescription,{children:A&&!isNaN(new Date(H).getTime())?`Selecciona un per\xedodo dentro del mismo a\xf1o para generar el balance. Per\xedodo de trabajo actual: ${(0,n.format)(new Date(H),"dd-MM-yyyy")} al ${(0,n.format)(new Date(S),"dd-MM-yyyy")}.`:"Por favor, define un período de trabajo en la configuración de la empresa para generar reportes."})]}),(0,a.jsx)(t.CardContent,{className:"space-y-6",children:(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(r.Label,{htmlFor:"start-date",children:"Fecha de Inicio"}),(0,a.jsx)(d.Input,{id:"start-date",type:"date",value:H,onChange:e=>R(e.target.value),disabled:!A})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(r.Label,{htmlFor:"end-date",children:"Fecha de Término"}),(0,a.jsx)(d.Input,{id:"end-date",type:"date",value:S,onChange:e=>M(e.target.value),disabled:!A})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsx)(s.Button,{onClick:()=>{if(!j||!T)return;let e=new Date(H),a=new Date(S);(0,b.getYear)(e)!==(0,b.getYear)(a)?g({variant:"destructive",title:"Rango de Fechas Inválido",description:"La fecha de inicio y término deben pertenecer al mismo año para generar el balance."}):(D(!0),v(function(e,a){let l=new Map;for(let a of e)l.set(a.code,{code:a.code,name:a.name,sumasDebe:0,sumasHaber:0,saldoDeudor:0,saldoAcreedor:0,activo:0,pasivo:0,perdida:0,ganancia:0});for(let e of a)if("Contabilizado"===e.status)for(let a of e.entries){let e=l.get(a.account);e&&(e.sumasDebe+=a.debit||0,e.sumasHaber+=a.credit||0)}for(let a of e){let e=l.get(a.code);if(e){let l=e.sumasDebe-e.sumasHaber;switch(l>0?e.saldoDeudor=l:l<0&&(e.saldoAcreedor=-l),a.type){case"Activo":e.activo=e.saldoDeudor-e.saldoAcreedor;break;case"Pasivo":case"Patrimonio":e.pasivo=e.saldoAcreedor-e.saldoDeudor;break;case"Gasto":e.perdida=e.saldoDeudor-e.saldoAcreedor;break;case"Ingreso":e.ganancia=e.saldoAcreedor-e.saldoDeudor}}}let t={sumasDebe:0,sumasHaber:0,saldoDeudor:0,saldoAcreedor:0,activo:0,pasivo:0,perdida:0,ganancia:0},s=Array.from(l.values());for(let e of s)t.sumasDebe+=e.sumasDebe,t.sumasHaber+=e.sumasHaber,t.saldoDeudor+=e.saldoDeudor,t.saldoAcreedor+=e.saldoAcreedor,t.activo+=e.activo,t.pasivo+=e.pasivo,t.perdida+=e.perdida,t.ganancia+=e.ganancia;let r=t.ganancia-t.perdida;return{rows:s.filter(e=>0!==e.sumasDebe||0!==e.sumasHaber),totals:t,resultadoDelEjercicio:r}}(j,T.filter(l=>{let t=new Date(l.date);return e.setUTCHours(0,0,0,0),a.setUTCHours(23,59,59,999),t.setUTCHours(0,0,0,0),t>=e&&t<=a&&"Contabilizado"===l.status}))),D(!1))},disabled:w||N||C||!A,className:"w-full",children:w?"Generando...":N||C?"Cargando datos...":"Generar Balance"})})]})})]}),y&&(0,a.jsxs)(t.Card,{children:[(0,a.jsxs)(t.CardHeader,{children:[(0,a.jsx)(t.CardTitle,{children:"Resultados del Balance"}),(0,a.jsx)(t.CardDescription,{children:`Per\xedodo del ${(0,n.format)(new Date(H),"P",{locale:h.es})} al ${(0,n.format)(new Date(S),"P",{locale:h.es})}`})]}),(0,a.jsx)(t.CardContent,{children:(0,a.jsxs)(o.Table,{children:[(0,a.jsxs)(o.TableHeader,{children:[(0,a.jsxs)(o.TableRow,{children:[(0,a.jsx)(o.TableHead,{rowSpan:2,className:"align-bottom sticky left-0 bg-background z-10",children:"Código"}),(0,a.jsx)(o.TableHead,{rowSpan:2,className:"align-bottom sticky left-[80px] bg-background z-10",children:"Cuenta Contable"}),(0,a.jsx)(o.TableHead,{colSpan:2,className:"text-center",children:"Sumas"}),(0,a.jsx)(o.TableHead,{colSpan:2,className:"text-center",children:"Saldos"}),(0,a.jsx)(o.TableHead,{colSpan:2,className:"text-center",children:"Inventario"}),(0,a.jsx)(o.TableHead,{colSpan:2,className:"text-center",children:"Resultados"})]}),(0,a.jsxs)(o.TableRow,{children:[(0,a.jsx)(o.TableHead,{className:"text-right",children:"Debe"}),(0,a.jsx)(o.TableHead,{className:"text-right",children:"Haber"}),(0,a.jsx)(o.TableHead,{className:"text-right",children:"Deudor"}),(0,a.jsx)(o.TableHead,{className:"text-right",children:"Acreedor"}),(0,a.jsx)(o.TableHead,{className:"text-right",children:"Activo"}),(0,a.jsx)(o.TableHead,{className:"text-right",children:"Pasivo"}),(0,a.jsx)(o.TableHead,{className:"text-right",children:"Pérdida"}),(0,a.jsx)(o.TableHead,{className:"text-right",children:"Ganancia"})]})]}),(0,a.jsx)(o.TableBody,{children:y.rows.map(e=>(0,a.jsxs)(o.TableRow,{children:[(0,a.jsx)(o.TableCell,{className:"font-mono text-xs sticky left-0 bg-background z-10",children:e.code}),(0,a.jsx)(o.TableCell,{className:"sticky left-[80px] bg-background z-10",children:e.name}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(e.sumasDebe)}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(e.sumasHaber)}),(0,a.jsx)(o.TableCell,{className:"text-right font-medium",children:f(e.saldoDeudor)}),(0,a.jsx)(o.TableCell,{className:"text-right font-medium",children:f(e.saldoAcreedor)}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(e.activo)}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(e.pasivo)}),(0,a.jsx)(o.TableCell,{className:"text-right text-red-600",children:f(e.perdida)}),(0,a.jsx)(o.TableCell,{className:"text-right text-green-600",children:f(e.ganancia)})]},e.code))}),(0,a.jsxs)(o.TableFooter,{children:[(0,a.jsxs)(o.TableRow,{className:"font-bold bg-muted/50",children:[(0,a.jsx)(o.TableCell,{colSpan:2,children:"Sub-Totales"}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(y.totals.sumasDebe)}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(y.totals.sumasHaber)}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(y.totals.saldoDeudor)}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(y.totals.saldoAcreedor)}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(y.totals.activo)}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(y.totals.pasivo)}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(y.totals.perdida)}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(y.totals.ganancia)})]}),(0,a.jsxs)(o.TableRow,{className:"font-bold",children:[(0,a.jsx)(o.TableCell,{colSpan:6}),(0,a.jsx)(o.TableCell,{children:k?"Utilidad del Ejercicio":"Pérdida del Ejercicio"}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(Math.abs(P))}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(k?Math.abs(P):0)}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(k?0:Math.abs(P))})]}),(0,a.jsxs)(o.TableRow,{className:"bg-secondary font-extrabold text-secondary-foreground",children:[(0,a.jsx)(o.TableCell,{colSpan:6}),(0,a.jsx)(o.TableCell,{colSpan:2,className:"text-center",children:"Sumas Iguales"}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(y.totals.activo)}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(y.totals.pasivo+P)})]}),(0,a.jsxs)(o.TableRow,{className:"bg-secondary font-extrabold text-secondary-foreground",children:[(0,a.jsx)(o.TableCell,{colSpan:8}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(y.totals.perdida+(k?P:0))}),(0,a.jsx)(o.TableCell,{className:"text-right",children:f(y.totals.ganancia+(k?0:P))})]})]})]})}),(0,a.jsx)(t.CardFooter,{className:"flex justify-center pt-8",children:(0,a.jsxs)(t.Card,{className:"w-fit p-6 shadow-lg",children:[(0,a.jsx)("p",{className:"text-center text-lg font-semibold",children:"Resultado del Ejercicio"}),(0,a.jsx)("p",{className:`text-center text-3xl font-bold ${k?"text-green-600":"text-red-600"}`,children:f(P)}),(0,a.jsx)("p",{className:"text-center text-sm text-muted-foreground",children:k?"(Utilidad)":"(Pérdida)"})]})})]})]})}e.s(["default",()=>p],56113)}]);